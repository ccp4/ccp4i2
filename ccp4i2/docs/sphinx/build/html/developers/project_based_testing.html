
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#00020a">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>CCP4I2 Developers: Project Based Testing &#8212; CCP4i2  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/contentui.css" />
    <link rel="stylesheet" type="text/css" href="https://github.com/bwithd/sphinx-material/blob/main/sphinx_material/sphinx_material/static/stylesheets/application.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/contentui.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CCP4I2 Developers: Remote Jobs" href="remote_jobs.html" />
    <link rel="prev" title="CCP4I2 Generating Reports using XRT" href="reports_xrt.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=#005BBB data-md-color-accent=yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500" id="__gitlab"><path fill="currentColor" d="M93.667 473.347l90.684-279.097H2.983l90.684 279.097z" transform="translate(156.198 1.16)"/><path fill="currentColor" d="M221.333 473.345L130.649 194.25H3.557l217.776 279.095z" transform="translate(28.531 1.16)" opacity=".7"/><path fill="currentColor" d="M32 195.155L4.441 279.97a18.773 18.773 0 0 0 6.821 20.99l238.514 173.29L32 195.155z" transform="translate(.089 .256)" opacity=".5"/><path fill="currentColor" d="M2.667-84.844h127.092L75.14-252.942c-2.811-8.649-15.047-8.649-17.856 0L2.667-84.844z" transform="translate(29.422 280.256)"/><path fill="currentColor" d="M2.667 473.345L93.351 194.25h127.092L2.667 473.345z" transform="translate(247.198 1.16)" opacity=".7"/><path fill="currentColor" d="M221.334 195.155l27.559 84.815a18.772 18.772 0 0 1-6.821 20.99L3.557 474.25l217.777-279.095z" transform="translate(246.307 .256)" opacity=".5"/><path fill="currentColor" d="M130.667-84.844H3.575l54.618-168.098c2.811-8.649 15.047-8.649 17.856 0l54.618 168.098z" transform="translate(336.974 280.256)"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#developers/project_based_testing" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="CCP4i2  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">CCP4i2  documentation</span>
          <span class="md-header-nav__topic"> CCP4I2 Developers: Project Based Testing </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">CCP4i2  documentation</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Developer Notes</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="CCP4i2 documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="CCP4i2 documentation">CCP4i2  documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
    </div>
  
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#developers-project-based-testing--page-root" class="md-nav__link">CCP4I2 Developers: Project Based Testing</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#creating-source-projects" class="md-nav__link">Creating Source Projects</a>
        </li>
        <li class="md-nav__item"><a href="#running-tests-non-graphically" class="md-nav__link">Running Tests Non-Graphically</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/developers/project_based_testing.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="ccp4i2-developers-project-based-testing">
<h1 id="developers-project-based-testing--page-root">CCP4I2 Developers: Project Based Testing<a class="headerlink" href="#developers-project-based-testing--page-root" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>Project based testing provides automatic testing of the non-graphical
aspects of tasks and also provide test data and indications of the
normal use for manual testing of the gui. Ideally we need one
test-project per task that exercises all the main functionality of task.
Some test projects that run through a series of tasks in a realistic
structure solution would also be useful for testing and as examples for
demonstrations and tutorials.</p>
<p>The automatic mechanism tests plugin scripts by rerunning all of the
jobs from a source project and comparing the output from the test jobs
with that from the source jobs. The source project can be set up
graphically in CCP4i2 but the test procedure is normally run
non-graphically by the <em>testi2sys</em> script. When the test jobs are run
they take their input files from the source project directory even where
the job input could be taken from a preceeding job in the test project
(but sub-jobs in pipelines do pass files through the pipeline in the
expected fashion).</p>
<p>After a test job has finished an automatic comparison is made of the
outputs. For each job run the test system calls
<em>CPluginScript.assertSame()</em> to do a comparison of the output data of
the source and the test job as taken from the <em>params.xml</em> file of the
two job runs. This method iterates over the data objects in the
<em>outputData</em> container and calls the <em>assertSame()</em> method passing it
the ‘other’ job run data value. This method returns a <em>CErrorReport</em>
which will contain a list of difference between the two values. Only the
<em>assertSame()</em> for file objects and performance indicator objects do
meaningful tests.</p>
<p>There is usually one performance indicator parameter per task whose main
function is a simple indication of progress shown in the <em>Job list</em> (see
<a class="reference external" href="./pipelines.html#performance_indicators">here</a>). The same parameter
turns out to be useful for comparison in testing. The implementations of
<em>CPerformanceIndicator.assertSame()</em> usually compares the float,int or
string members of the class - there is an allowed tolerance and it can
be specified that a changed value may be an improvement (e.g. a decrease
in test Rfactor compared to source is reported as a warning not an
error). It is possible to implement a performance indicator class so
that it serves as a test class but does not put anything in the database
or <em>Job list</em> (eg. <em>CAtomCountPerformance</em>).</p>
<p>The test on output files is that they exist and then dependent on file
type:</p>
<table>
<tbody>
<tr class="row-odd"><td><p>CDataFile</p></td>
<td><p>compare file checksum and/or optionally file size</p></td>
</tr>
<tr class="row-even"><td><p>CPdbDataFile</p></td>
<td><p>compare file checksum with <em>ad hoc</em> editing out of
problem meta data</p></td>
</tr>
<tr class="row-odd"><td><p>CMtzDataFile</p></td>
<td><p>compare cell,spaceGroup,resolutionRange, number of
reflections and column types/labels</p></td>
</tr>
</tbody>
</table>
<p>File comparison is tricky - for example a checksum test on PDB files
output by Molrep failed because of the date in a HEADER line - this has
been adressed but more, similar gotchas are expected. This is a work in
progress - please talk to Liz about any false calls and suggestions.</p>
<p>The <em>com.txt</em> input file for the program run by each task is also
compared.</p>
<p>The results are listed to the terminal and saved to a file in the test
project called <em>CCP4_test-</em>year-month-day-hour-minute<em>.log</em>.</p>
</section>
<section id="creating-source-projects">
<h2 id="creating-source-projects">Creating Source Projects<a class="headerlink" href="#creating-source-projects" title="Permalink to this heading">¶</a></h2>
<p>A source project can be created as a normal project within CCP4i2. All
jobs should be reasonably quick to run and complete successfully. The
source project is exported by the <em>Export</em> option in the <em>Manage
projects</em> window (accessed from the <em>Projects</em> menu). This creates a zip
file which can be sent to Liz for inclusion in the automatic test suite.
Before exporting the test project please test it from the <em>Manage
projects</em> window by selecting the appropriate project and using the
<em>Rerun test project</em> option - you will be required to specify a
directory for output. Note that <em>Rerun test project</em> is only available
if you are running in <em>DEVELOPER</em> mode (if necessary edit
<em>.CCP4I2/configs/ccp4i2_cofig.params.xml</em> and set <em>developer</em> to
<em>True</em>). A test directory will be created and the test jobs will then
proceed automatically one at a time. The results from the comparison of
the source tasks and the test tasks are shown in real time in a web
browser window. You can also open the project window for the test
project to view progress. The test results are also saved to a file in
the test project directory called
<em>CCP4_test-</em>year-month-day-hour-minute<em>.log</em>. The log file should
list each job that is run (only the top level jobs) and the output data
from the job looking like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Job</span><span class="p">:</span> <span class="mi">1</span> <span class="n">molrep_mr</span>
<span class="n">XYZOUT</span>               <span class="o">-</span><span class="n">OK</span><span class="o">-</span> <span class="n">CPdbDataFile</span><span class="p">:</span><span class="mi">300</span> <span class="n">Compared</span> <span class="n">objects</span> <span class="n">are</span> <span class="n">the</span> <span class="n">same</span>
<span class="n">Job</span><span class="p">:</span> <span class="mi">35</span> <span class="n">buccaneer_build_refine</span>
<span class="n">XYZOUT</span>               <span class="o">-</span><span class="n">OK</span><span class="o">-</span> <span class="n">CPdbDataFile</span><span class="p">:</span><span class="mi">300</span> <span class="n">Compared</span> <span class="n">objects</span> <span class="n">are</span> <span class="n">the</span> <span class="n">same</span>
<span class="n">FPHIOUT</span>              <span class="o">-</span><span class="n">ERROR</span><span class="o">-</span> <span class="n">CMapCoeffsDataFile</span><span class="p">:</span><span class="mi">308</span> <span class="n">Files</span> <span class="n">failed</span> <span class="n">checksum</span> <span class="n">comparison</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">lizp</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">testing</span><span class="o">/</span><span class="n">demo8</span><span class="o">/</span><span class="n">CCP4_JOBS</span><span class="o">/</span><span class="n">job_35</span><span class="o">/</span><span class="n">FPHIOUT</span><span class="o">.</span><span class="n">mtz</span> <span class="p">:</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">lizp</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">testing</span><span class="o">/</span><span class="n">demo8_rerun</span><span class="o">/</span><span class="n">CCP4_JOBS</span><span class="o">/</span><span class="n">job_35</span><span class="o">/</span><span class="n">FPHIOUT</span><span class="o">.</span><span class="n">mtz</span>
<span class="o">...</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The items on the line for each item of data are: the parameter name, the
test status (OK,WARNING or ERROR), the data class, the error code (error
code 300 is ‘OK’) and further details. If this test run fails to run of
gives false fails please discuss with Liz.</p>
<p>Note that if you look at the test project in the <em>Project Viewer</em> the
imported files will be absent.</p>
</section>
<section id="running-tests-non-graphically">
<h2 id="running-tests-non-graphically">Running Tests Non-Graphically<a class="headerlink" href="#running-tests-non-graphically" title="Permalink to this heading">¶</a></h2>
<p>A test project or a suite of test projects can be run using the
<em>ccp4i2/bin/testi2sys</em> script. This script works with a temporary
database and unpacks the source projects into the <em>outputDirectory</em> and
loads them into the database. It then reruns the source projects
creating a test project. Each test project is given the name of the
source project with the date and time and ‘_rerun’ appended. The test
project directories created in the <em>outputDirectory</em> are given the test
project name. The jobs from the source project are then run one at a
time with progress and errors listed to the terminal and saved to file
<em>CCP4_test…..log</em> in the <em>outputDirectory</em>. The command line
arguments:</p>
<table>
<tbody>
<tr class="row-odd"><td><p>-p <em>path</em></p></td>
<td><p>path of a compressed source project file or a
directory containing them</p></td>
</tr>
<tr class="row-even"><td><p>-d <em>directory</em></p></td>
<td><p>directory where the compressed source project
is unpacked and temporary database and test
projects are created</p></td>
</tr>
<tr class="row-odd"><td><p>-o</p></td>
<td><p>Overwrite any existing temporary database</p></td>
</tr>
<tr class="row-even"><td><p>-runMode <em>flag</em></p></td>
<td><p>0 :no testing, 1 :run jobs, 2:run tests,
3:run jobs and tests. Default: 3</p></td>
</tr>
<tr class="row-odd"><td><p>-verbosity <em>flag</em></p></td>
<td><p>Report 0:fails only, 1:jobs and parameters
tested, 3:jobs, parameters and parameter
values. Default: 1</p></td>
</tr>
<tr class="row-even"><td><p>-testSubJobs <em>flag</em></p></td>
<td><p>0:no, 1:for failed jobs, 2:for all jobs.
Default:1</p></td>
</tr>
</tbody>
</table>
<p>Last modified: Thu Jan 29 12:22:01 GMT 2015</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="reports_xrt.html" title="CCP4I2 Generating Reports using XRT"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> CCP4I2 Generating Reports using XRT </span>
              </div>
            </a>
          
          
            <a href="remote_jobs.html" title="CCP4I2 Developers: Remote Jobs"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> CCP4I2 Developers: Remote Jobs </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2020, CCP4.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.2.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>