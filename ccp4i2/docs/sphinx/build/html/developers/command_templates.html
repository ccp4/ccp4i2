
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#00020a">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>CCP4I2 Developers Program Command Templates &#8212; CCP4i2  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/contentui.css" />
    <link rel="stylesheet" type="text/css" href="https://github.com/bwithd/sphinx-material/blob/main/sphinx_material/sphinx_material/static/stylesheets/application.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/contentui.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CCP4I2 Developers Error Handling" href="error_handling.html" />
    <link rel="prev" title="CCP4I2 Developers: Remote Jobs" href="remote_jobs.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=#005BBB data-md-color-accent=yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500" id="__gitlab"><path fill="currentColor" d="M93.667 473.347l90.684-279.097H2.983l90.684 279.097z" transform="translate(156.198 1.16)"/><path fill="currentColor" d="M221.333 473.345L130.649 194.25H3.557l217.776 279.095z" transform="translate(28.531 1.16)" opacity=".7"/><path fill="currentColor" d="M32 195.155L4.441 279.97a18.773 18.773 0 0 0 6.821 20.99l238.514 173.29L32 195.155z" transform="translate(.089 .256)" opacity=".5"/><path fill="currentColor" d="M2.667-84.844h127.092L75.14-252.942c-2.811-8.649-15.047-8.649-17.856 0L2.667-84.844z" transform="translate(29.422 280.256)"/><path fill="currentColor" d="M2.667 473.345L93.351 194.25h127.092L2.667 473.345z" transform="translate(247.198 1.16)" opacity=".7"/><path fill="currentColor" d="M221.334 195.155l27.559 84.815a18.772 18.772 0 0 1-6.821 20.99L3.557 474.25l217.777-279.095z" transform="translate(246.307 .256)" opacity=".5"/><path fill="currentColor" d="M130.667-84.844H3.575l54.618-168.098c2.811-8.649 15.047-8.649 17.856 0l54.618 168.098z" transform="translate(336.974 280.256)"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#developers/command_templates" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="CCP4i2  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">CCP4i2  documentation</span>
          <span class="md-header-nav__topic"> CCP4I2 Developers Program Command Templates </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">CCP4i2  documentation</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Developer Notes</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="CCP4i2 documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="CCP4i2 documentation">CCP4i2  documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
    </div>
  
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#developers-command-templates--page-root" class="md-nav__link">CCP4I2 Developers Program Command Templates</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#template-format" class="md-nav__link">Template Format</a>
        </li>
        <li class="md-nav__item"><a href="#notes" class="md-nav__link">Notes</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/developers/command_templates.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="ccp4i2-developers-program-command-templates">
<h1 id="developers-command-templates--page-root">CCP4I2 Developers Program Command Templates<a class="headerlink" href="#developers-command-templates--page-root" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>CCP4i2 supports a template mechanism for generating program command
files similar to that in CCP4i. The underlying code has been re-written
as the Python module <em>CCP4ComTemplate</em> and the format of the template
file is somewhat changed to be compatible with CCP4i2 <em>CData</em> classes
and to be more Python-like. Nevertheless it should be relatively
straight-forward to convert old Tcl-based templates to the new template
style.</p>
<p>The template mechanism can be used from the plugins based on
<em>CPluginScript</em>. The template can either be coded within the
<em>CPluginScript</em> sub-class as the attribute COMTEMPLATE (see
<a class="reference external" href="./pipelines.html#CPluginScript">here</a>) or coded in a separate file
that should be placed in the $CCP4I2/templates directory. The benefit of
the separate file is that different plugin wrappers performing slightly
different functions but using the same program could use the same
template. If the template is in a separate file then the file should be
specified in the COMTEMLATEFILE attribute of the plugin. The command
file generation is usually handled by
<em>CPluginScript.makeCommandAndScript</em> but can be run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">core.CCP4ComTemplate</span> <span class="kn">import</span> <span class="n">CComTemplate</span>
<span class="n">comTemplate</span> <span class="o">=</span> <span class="n">CComTemplate</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="c1"># Load the template from a file</span>
<span class="n">errorReport</span> <span class="o">=</span> <span class="n">comTemplate</span><span class="o">.</span><span class="n">loadTemplateFromFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
<span class="c1"># make a command script - pass makeComScript a CContainer containing the data</span>
<span class="n">comScript</span><span class="p">,</span><span class="n">errorReport</span> <span class="o">=</span> <span class="n">comTemplate</span><span class="o">.</span><span class="n">makeComScript</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively if the template is in a text string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">core.CCP4ComTemplate</span> <span class="kn">import</span> <span class="n">CComTemplate</span>
<span class="n">comTemplate</span> <span class="o">=</span> <span class="n">CComTemplate</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">template</span><span class="o">=</span><span class="n">templateString</span><span class="p">)</span>
<span class="c1"># make a command script - pass makeComScript a CContainer containing the data</span>
<span class="n">comScript</span><span class="p">,</span><span class="n">errorReport</span> <span class="o">=</span> <span class="n">comTemplate</span><span class="o">.</span><span class="n">makeComScript</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that methods return a
<a class="reference external" href="./data_classes.html#error%20handling">CErrorReport</a> that is
particularly useful in the case of <em>makeComScript()</em> for listing any
issues in interpreting the template.</p>
</section>
<section id="template-format">
<h2 id="template-format">Template Format<a class="headerlink" href="#template-format" title="Permalink to this heading">¶</a></h2>
<p>A one-line fragment of REFMAC template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$EXCLUDE_RESOLUTION  refi resolution $EXCLUDE_RESOLUTION_RANGE.start $EXCLUDE_RESOLUTION_RANGE.end
</pre></div>
</div>
<p>By default one line of the template is converted into one line in the
command file. The template line is only written to the command file if
the first word of the line, the ‘write flag’, evaluates to <em>True</em>. The
write flag might be a ‘1’ (the line is always written), a reference to a
parameter or a Python expression that may include references to
parameters. In this example the first word begins with a $ which means
that it is a reference to the ‘EXCLUDE_RESOLUTION’ parameter. A
parameter called ‘EXCLUDE_RESOLUTION’ is sought in the container passed
to the <em>CComTemplate</em>. The search mechanism will search any
sub-containers in the container. If there is no ‘EXCLUDE_RESOLUTION’
parameter then a report is appended to the <em>errorReport</em> and the line is
not written. If ‘EXCLUDE_RESOLUTION’ is found and is True then the rest
of the line is written to the command file. The words ‘refi resolution’
are written automatically and then the container is searched for a
‘EXCLUDE_RESOLUTION_RANGE’ parameter and the ‘start’ and ‘end’
attributes are written to the command file. If no
‘EXCLUDE_RESOLUTION_RANGE’ parameter is found then the whole line is not
written to the command file. Note that the names of attributes such as
‘start’ and ‘end’ must correspond to the contents on the <em>CData</em> class
that holds the data (in this case it is a <em>CFloatRange</em>). The use of
classes with attributes is a major difference of the Python CCP4i2 and
is the major issue if updating from old templates.</p>
<p>A more complex fragment of the REFMAC template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1 refi
 - 1 type $REFINE_TYPE
 - {['PHASE','HL'].count($INPUT_PHASE)} PHASE SCBL $PHASE_SCBLUR BBLU $PHASE_BBLUR
 - 1 resi MLKF
 - 1 meth CGRAD
IF { ['IDEA','RIGID'].count($REFINE_TYPE) }
 - 1 bref over
ELSE
 - 1 bref $B_REFINEMENT_MODE
ENDIF
</pre></div>
</div>
<p>In this example the first character of several lines is a hyphon (-)
which means that this line is a continuation of the previous line and
will be reassembled into one line in the command file. The second word
on continuation lines is a write flag for whether this fragment of a
line will be written to the command file. The write flag in the third
line in this fragment is a fragment of Python code (
<em>{[‘PHASE’,’HL’].count($INPUT_PHASE)}</em>) that is enclosed by curly
braces. This code fragment is testing whether the INPUT_PHASE has one of
two given values; the list <em>count()</em> will return a value of 1 if the
parameter has a value given in the list.</p>
<p>This example also has an IF-ELSE-ENDIF statement. The template
mechasnism supports several types of compound statement. These must be
written in upper case and on separate lines as shown in the examples
below and compound statements can be nested.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>LOOP N 1 $N_NONX
1 ncsr nchains $N_NONX_CHN_TOTAL($N) chains $NONX_CHN_SRC($N) $NONX_CHN_TARG($N)
  LOOP I 1 $N_NONX_CHN($N)
     - 1 $NONX_CHN($N,$I)
  ENDLOOP
  - 1 nspans $N_NONX_SPANS_TOTAL($N)
  - 1 $NONX_INIT_SPANS_RES1($N) $NONX_INIT_SPANS_RES2($N) $NONX_INIT_SPANS_CODE($N)
  LOOP J 1 $N_NONX_SPANS($N)
    - 1 $NONX_SPANS_RES1($N,$J) $NONX_SPANS_RES2($N,$J) $NONX_SPANS_CODE($N,$J)
  ENDLOOP
ENDLOOP
</pre></div>
</div>
<p>The example writes the non-crstallographic symmetry using a outer
LOOP-ENDLOOP with the variable N and two inner LOOP-ENDLOOP with the
vaiables I and J. Note that the LOOP statement does allow an <em>increment</em>
parameter after the <em>start</em> and <em>end</em> parameters. Note also how arrays
are references.</p>
<p>The other supported compound statement is CASE-CASEMATCH-ENDCASE. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CASE $WHATEVER
CASEMATCH 12
  1 matched 12
CASEMATCH  24
  1 matched 24
ENDCASE
</pre></div>
</div>
<p>It is possible to incorporate another template file into the present one
with the AT command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AT $CCP4I2_TOP/test/data/test_com_template_1.com
</pre></div>
</div>
</section>
<section id="notes">
<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Permalink to this heading">¶</a></h2>
<p>It is sometimes necessary to put quotes around parameters in the program
script files - for space groups is the specific example. This can be
done by appending <em>.quote</em> to the data item to be put in quotes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1 SYMM $SPACEGROUP.quote
</pre></div>
</div>
<p>Last modified: Thu Jun 16 17:14:24 BST 2011</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="remote_jobs.html" title="CCP4I2 Developers: Remote Jobs"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> CCP4I2 Developers: Remote Jobs </span>
              </div>
            </a>
          
          
            <a href="error_handling.html" title="CCP4I2 Developers Error Handling"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> CCP4I2 Developers Error Handling </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2020, CCP4.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.2.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>