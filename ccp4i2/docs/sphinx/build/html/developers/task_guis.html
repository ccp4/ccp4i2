
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#00020a">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>CCP4I2 Developers: Writing Task GUIs &#8212; CCP4i2  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/contentui.css" />
    <link rel="stylesheet" type="text/css" href="https://github.com/bwithd/sphinx-material/blob/main/sphinx_material/sphinx_material/static/stylesheets/application.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/contentui.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CCP4I2 Developers: Wrappers and Pipelines" href="pipelines.html" />
    <link rel="prev" title="Database Recovery Guide" href="CCP4i2_DB_Recovery.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=#005BBB data-md-color-accent=yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500" id="__gitlab"><path fill="currentColor" d="M93.667 473.347l90.684-279.097H2.983l90.684 279.097z" transform="translate(156.198 1.16)"/><path fill="currentColor" d="M221.333 473.345L130.649 194.25H3.557l217.776 279.095z" transform="translate(28.531 1.16)" opacity=".7"/><path fill="currentColor" d="M32 195.155L4.441 279.97a18.773 18.773 0 0 0 6.821 20.99l238.514 173.29L32 195.155z" transform="translate(.089 .256)" opacity=".5"/><path fill="currentColor" d="M2.667-84.844h127.092L75.14-252.942c-2.811-8.649-15.047-8.649-17.856 0L2.667-84.844z" transform="translate(29.422 280.256)"/><path fill="currentColor" d="M2.667 473.345L93.351 194.25h127.092L2.667 473.345z" transform="translate(247.198 1.16)" opacity=".7"/><path fill="currentColor" d="M221.334 195.155l27.559 84.815a18.772 18.772 0 0 1-6.821 20.99L3.557 474.25l217.777-279.095z" transform="translate(246.307 .256)" opacity=".5"/><path fill="currentColor" d="M130.667-84.844H3.575l54.618-168.098c2.811-8.649 15.047-8.649 17.856 0l54.618 168.098z" transform="translate(336.974 280.256)"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#developers/task_guis" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="CCP4i2  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">CCP4i2  documentation</span>
          <span class="md-header-nav__topic"> CCP4I2 Developers: Writing Task GUIs </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">CCP4i2  documentation</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Developer Notes</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="CCP4i2 documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="CCP4i2 documentation">CCP4i2  documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
    </div>
  
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#developers-task-guis--page-root" class="md-nav__link">CCP4I2 Developers: Writing Task GUIs</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#folders-tabs" class="md-nav__link">Folders/Tabs</a>
        </li>
        <li class="md-nav__item"><a href="#ctaskwidget-class-overview" class="md-nav__link">CTaskWidget class overview</a>
        </li>
        <li class="md-nav__item"><a href="#createline-definition-keywords" class="md-nav__link">createLine() definition keywords</a>
        </li>
        <li class="md-nav__item"><a href="#toggle-and-togglefunction-arguments" class="md-nav__link">toggle and toggleFunction arguments</a>
        </li>
        <li class="md-nav__item"><a href="#accessing-individual-widgets" class="md-nav__link">Accessing individual widgets</a>
        </li>
        <li class="md-nav__item"><a href="#widget-qualifers" class="md-nav__link">Widget Qualifers</a>
        </li>
        <li class="md-nav__item"><a href="#using-the-qt-signals-and-slots" class="md-nav__link">Using the Qt Signals and Slots</a>
        </li>
        <li class="md-nav__item"><a href="#data-analysis-in-the-task-gui" class="md-nav__link">Data analysis in the task gui</a>
        </li>
        <li class="md-nav__item"><a href="#validation-and-changing-parameter-qualifiers" class="md-nav__link">Validation and changing parameter qualifiers</a>
        </li>
        <li class="md-nav__item"><a href="#auto-generating-guis" class="md-nav__link">Auto-generating GUIs</a>
        </li>
        <li class="md-nav__item"><a href="#multiple-task-interfaces-to-one-wrapper" class="md-nav__link">Multiple Task Interfaces to One Wrapper</a>
        </li>
        <li class="md-nav__item"><a href="#the-task-menu" class="md-nav__link">The Task Menu</a>
        </li>
        <li class="md-nav__item"><a href="#creating-child-pop-out-task-gui" class="md-nav__link">Creating Child Pop-out Task GUI</a>
        </li>
        <li class="md-nav__item"><a href="#speeding-drawing-of-tasks" class="md-nav__link">Speeding drawing of tasks</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/developers/task_guis.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="ccp4i2-developers-writing-task-guis">
<h1 id="developers-task-guis--page-root">CCP4I2 Developers: Writing Task GUIs<a class="headerlink" href="#developers-task-guis--page-root" title="Permalink to this heading">¶</a></h1>
<div class="line-block">
<div class="line"><a class="reference external" href="#introduction">Introduction</a></div>
<div class="line"><a class="reference external" href="#folders">Folders/tabs</a></div>
<div class="line"><a class="reference external" href="#CTaskWidget">CTaskWidget class overview</a></div>
<div class="line"><a class="reference external" href="#createLine">createLine() definition keywords</a></div>
<div class="line"><a class="reference external" href="#toggle">toggle and toggleFunction arguments</a></div>
<div class="line"><a class="reference external" href="#accessing_widgets">Accessing individual widgets</a></div>
<div class="line"><a class="reference external" href="#widget_qualifiers">Widget Qualifers</a></div>
<div class="line"><a class="reference external" href="#signals_and_slots">Using the Qt Signals and Slots</a></div>
<div class="line"><a class="reference external" href="#data_analysis">Data analysis in the task gui</a></div>
<div class="line"><a class="reference external" href="#setQualifiers">Changing parameter qualifiers</a></div>
<div class="line"><a class="reference external" href="#autogenerating_guis">Auto-generating GUIs</a></div>
<div class="line"><a class="reference external" href="#multiple_task_guis">Multiple Task Interfaces to One Wrapper</a></div>
<div class="line"><a class="reference external" href="#taskmenu">The Task Menu</a></div>
<div class="line"><a class="reference external" href="#popout_tasks">Creating Child Pop-out Task GUI</a></div>
<div class="line"><a class="reference external" href="#speedup">Speeding drawing of tasks</a></div>
</div>
<section id="introduction">
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>Please read the <a class="reference external" href="./data_classes.html">Data Classes</a> documentation
first.</p>
<p>If you have implemented a wrapper or pipeline in the ccp4i2 wrappers or
pipelines directories then a basic gui can be autogenerated from the def
file and will be accessible from the ‘Wrappers’ section at the bottom of
the list of jobs. Note that if the wrapper uses some data object that
does not have a corresponding widget implelemented then that data will
not appear in the gui and you need to ask Liz to fix that. To create a
better gui you need to implement a Python script called
tasks/mytask/CTaskmytask.py as a subclass of CTaskWidget from
qtgui/CCP4TaskWidget. See &lt; a
href=”../../tasks/buccaneer_build_refine/CTaskbuccaneer_build_refine.py”&gt;tasks/buccaneer_build_refine/CTaskbuccaneer_build_refine.py
for an example.Also look at &lt; a
href=”../../tasks/demo/CTaskdemo.py”&gt;tasks/demo/CTaskdemo.py does not
interface to any real wrapper but is used to test and demo gui features.</p>
<p>Note that if there is an error in the Python file which prevents it
being imported when CCP4i2 starts then this is reported to the terminal
and the <em>Program print log</em> (under <em>Utilities</em> pull-down menu) and the
task will not appear on the task menu. Any other errors will be reported
to the same places when you try to open the task widget.</p>
</section>
<section id="folders-tabs">
<h2 id="folders-tabs">Folders/Tabs<a class="headerlink" href="#folders-tabs" title="Permalink to this heading">¶</a></h2>
<p>The task gui is split into ‘folders’ or ‘tabs’; these two modes depend
on the option under <em>Preferences</em> but do not require any alternative
coding by the application programmer. The top folder is <em>Input Data</em>
which should contain all of the required input files or data. Ideally a
user should be able to run the program without looking at any other
folder. There are currently a couple of features in the <em>Input Data</em>
folder that are added by the core system:</p>
<ul class="simple">
<li><p>an option to set the job title</p></li>
<li><p>a ‘follow from’ option to choose a previous job whose ouput data will
be input to this job</p></li>
</ul>
<p>The ‘follow from’ features should be switched off (
CTaskWidget.AUTOPOPULATEINPUT = False ) if the the task is only
importing data. Note that the application should not have any <em>jobTitle</em>
parameter that would be redundant with the <em>jobTitle</em> parameter handled
by the core. The parameters managed by the core are recorded in the task
container in a sub-container named <em>guiParams</em> and appear at the bottom
of the params files.</p>
<p>The ‘follow from’ feature is implemented by the core system but, for the
appropriate input files, the qualifier <em>fromPreviousJob</em> must be set
<em>True</em>. There is no ‘Output Data’ folder - the output file names are set
automatically and the user can ‘export’ files after the job has
completed. Also there is no ‘Protocol’ folder (as ther was in CCP4i) so
some options that may have gone in the ‘Protocol’ folder may now be in
the ‘Input data’ folder. There is usually an <em>Options</em> folder for basic
options and then there may be one of more specific advanced options
folders.</p>
<p>Note that the initial opening of a complex task in the gui can take
significant time and a way to speed this up is to only draw the ‘hidden’
task frames when the user opens them - see <a class="reference external" href="#speedup">speedup</a> below.</p>
</section>
<section id="ctaskwidget-class-overview">
<h2 id="ctaskwidget-class-overview">CTaskWidget class overview<a class="headerlink" href="#ctaskwidget-class-overview" title="Permalink to this heading">¶</a></h2>
<p>Minimal code to create a new task widget:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qtgui</span> <span class="kn">import</span> <span class="n">CCP4TaskWidget</span>
<span class="k">class</span> <span class="nc">CTaskBuccaneer</span><span class="p">(</span><span class="n">CCP4TaskWidget</span><span class="o">.</span><span class="n">CTaskWidget</span><span class="p">):</span>
  <span class="n">TASKNAME</span> <span class="o">=</span> <span class="s1">'buccaneer'</span>
  <span class="n">TASKVERSION</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="n">TASKMODULE</span><span class="o">=</span><span class="s1">'model_building'</span>
  <span class="n">TASKTITLE</span><span class="o">=</span><span class="s1">'Buccaneer automated model building'</span>
  <span class="n">SHORTTASKTITLE</span><span class="o">=</span><span class="s1">'Buccaneer'</span>
  <span class="n">WHATNEXT</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'coot_rebuild'</span><span class="p">,</span><span class="s1">'refmac_martin'</span><span class="p">,</span><span class="s1">'buccaneer_build_refine'</span><span class="p">]</span>
  <span class="n">MGDISPLAYFILES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'XYZOUT'</span><span class="p">]</span>
  <span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="s1">'''Do several cycles of alternate model building with Buccaneer and refinement with Refmac'''</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
    <span class="n">CCP4TaskWidget</span><span class="o">.</span><span class="n">CTaskWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">drawContents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The essential attributes for the sub-class</p>
<ul class="simple">
<li><p>TASKNAME - the task name that should be the same as the TASKNAME in
the corresponding wrapper</p></li>
<li><p>TASKVERSION - the versioning is not currently used but should
correspond to the wrapper version How should it map to CCP4 and
program versions??</p></li>
<li><p>TASKMODULE - the catagory that the task appears in on the gui task
menu. Must be one of those listed in <em>MODULE_ORDER</em> in
<em>qtcore/CCP4TaskManager.py</em>. The <em>wrapper</em> and <em>test</em> modules will
not appear in a release version of the program.</p></li>
<li><p>TASKTITLE - title to appear in the gui task menu.</p></li>
<li><p>SHORTTASKTITLE - short title to appear in the gui where brevity
necessary e.g. ‘What next’and JobList .</p></li>
<li><p>DESCRIPTION - a longer description to appear as a tooltip in the gui
task menu.</p></li>
<li><p>MGDISPLAYFILES - a list of the parameters containing the names of
files to be displayed in molecular graphics for this job</p></li>
<li><p>WHATNEXT - a list of tasks that may follow after this task (or
implement <em>whatNext()</em> function - see below).</p></li>
<li><p>PROGRAMHELP - a list of program help files found as
$CCP4/html/xxxx.html to be listed under Help button</p></li>
</ul>
<p>Other possible attributes:</p>
<ul class="simple">
<li><p>CLONEABLE - Boolean flag if the task can be cloned - default is True</p></li>
<li><p>EDITOR - is the task solely for data input (default False). If True
the gui is modified to give a ‘Save’ button rather than a ‘Run’
button.</p></li>
<li><p>AUTOPOPULATEINPUT - can the inputs to this task be auto-populated
from a previous task (default True)</p></li>
</ul>
<p>The <em>drawContents()</em> method should specify the layout of the gui using
the library of methods documented below.</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>CTaskWidget method</p></th>
<th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>openFolder</p></td>
<td><p>Start definition of a
tab or folder</p></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>folderFunction</p></td>
<td><p>Default is ‘general’
- should be
‘inputData’ for first
folder</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>title</p></td>
<td><p>A short title to
appear on folder tab
or title bar</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>toggle</p></td>
<td><p>A list of parameters
for controlling
visibility of the
folder - <a class="reference external" href="#toggle">see
below</a></p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>toggleFunction</p></td>
<td><p>A list of parameters
for controlling
visibility of the
folder - <a class="reference external" href="#toggle">see
below</a></p></td>
</tr>
<tr class="row-odd"><td><p>closeFolder</p></td>
<td><p>End definition of a
tab or folder</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>createLine</p></td>
<td></td>
<td><p>Define content on one
line of the gui -
returns a Qt QFrame</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>defintion</p></td>
<td><p>list of strings that
are keywords and
parameters to define
line content (<a class="reference external" href="#createLine">see
be
low</a>)</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>toggle</p></td>
<td><p>A list of parameters
for controlling
visibility of the
line - <a class="reference external" href="#toggle">see
below</a></p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>toggleFunction</p></td>
<td><p>A list of parameters
for controlling
visibility of the
line - <a class="reference external" href="#toggle">see
below</a></p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>appendLine</p></td>
<td><p>A preceeding line (as
returned by
<em>createLine()</em>) to
which this ‘line’ is
appended</p></td>
</tr>
<tr class="row-odd"><td><p>openSubFrame</p></td>
<td><p>Start definition of
lines that are
grouped for purpose
of toggling
visibility or
creating a frame.
Returns a Qt QFrame.</p></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>frame</p></td>
<td><p>default False - if
true draw a frame
around the sub-frame</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>toggle</p></td>
<td><p>A list of parameters
for controlling
visibility of the
sub-frame - <a class="reference external" href="#toggle">see
below</a></p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>toggleFunction</p></td>
<td><p>A list of parameters
for controlling
visibility of the
folder - <a class="reference external" href="#toggle">see
below</a></p></td>
</tr>
<tr class="row-odd"><td><p>closeSubFrame</p></td>
<td><p>End definition of
group pf lines</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>openStack</p></td>
<td><p>Open definition of a
stack of two or more
lines of which only
one will be displayed</p></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>controlVar</p></td>
<td><p>Name of variable
controlling which
line in the stack is
visible. This
variable is probable
presented as radio
buttons in the
preceeding line of
the gui.</p></td>
</tr>
<tr class="row-even"><td><p>closeStack</p></td>
<td><p>End definition of a
stack</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>createRadioGroup</p></td>
<td><p>Create set of radio
buttons aranged one
per line</p></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>label</p></td>
<td><p>A string label</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>itemList</p></td>
<td><p>A list of string
labels for each radio
button</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>objectName</p></td>
<td><p>The name of the
parameter that is
controlled by the
radio buttons -
expected to have
<em>enumerators</em>
qualifer that is list
same length as
<em>itemList</em></p></td>
</tr>
<tr class="row-odd"><td><p>setHelpFile</p></td>
<td><p>Name of help file
linked to by all
widgets defined after
a call to this method</p></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>helpFile</p></td>
<td><p>The name of a file
that is expected to
be found in
$CCP4_TOP/docs/tasks</p></td>
</tr>
<tr class="row-odd"><td><p>whatNext</p></td>
<td><p>This is a module
level function that
returns a list of
suggested next tasks.</p></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>jobId</p></td>
<td><p>The id of a finished
job that is an
instance of this task</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The following methods may be needed to define some more dynamic
behaviour.</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>CTaskWidget method</p></th>
<th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>visibleFolder</p></td>
<td><p>Return the index of the
curently visible ‘folder’
- only relevant in tab
mode.</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>setVisibleFolder</p></td>
<td><p>Set which ‘folder’ is
visible (only relevant in
tab mode)</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>title</p></td>
<td><p>title of ‘folder’</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>index</p></td>
<td><p>index of folder (only one
of these arments should
be used)</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td colspan="2"><p>getContainer</p></td>
<td><p>Return the instance of
<em>CContainer</em> which holds
the task parameters</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>getWidget</p></td>
<td><p>Return the widget for the
named parameter</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>name</p></td>
<td><p>Parameter name</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>project</p></td>
<td><p>Return the name of the
project of the job open
in the task window</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>jobId</p></td>
<td><p>Return the id of the job
(an integer) of the job
open in the task window</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>getParams</p></td>
<td><p>Return python dict of
values of parameters
currently set in the gui</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>paramsValues</p></td>
<td><p>A Python dict whose keys
are the names of the
parameters whose values
are required.</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>setParams</p></td>
<td><p>Set gui widget values to
reflect the input
parameters</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>paramsValues</p></td>
<td><p>A Python dict of values
to be set in the gui</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>updateViewFromModel</p></td>
<td><p>refresh the gui from the
parameters in the task
container</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>validate</p></td>
<td><p>validate and mark any
invalid parameters in the
gui</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>isValid</p></td>
<td><p>Return a list of any
invalid parameters in the
gui</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>createWidget</p></td>
<td><p>Return an instance of the
appropriate widget for a
named parameter in the
task container</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>name</p></td>
<td><p>Parameter name</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>widgetQualifiers</p></td>
<td><p>a Python dict of
qualifying parameters for
the widget</p></td>
</tr>
</tbody>
</table>
</section>
<section id="createline-definition-keywords">
<h2 id="createline-definition-keywords">createLine() definition keywords<a class="headerlink" href="#createline-definition-keywords" title="Permalink to this heading">¶</a></h2>
<p>The <em>definition</em> argument to <em>createLine()</em> is a list of strings which
consist of keywords followed by a fixed number of arguments. Note that a
‘line’ may be a very fat line containing a complex widget - in this case
there should probably be no other labels or widgets specified in the
line.</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>keyword</p></th>
<th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>help</p></td>
<td></td>
<td><p>A help link applied to all following
widgets in the line</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>target</p></td>
<td><p>The target part of the link -
complements the file specified by
<em>setHelpFile()</em></p></td>
</tr>
<tr class="row-even"><td><p>tip</p></td>
<td></td>
<td><p>Tooltip to apply to all following
widgets in the line</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>tip</p></td>
<td><p>A short text string</p></td>
</tr>
<tr class="row-even"><td><p>message</p></td>
<td></td>
<td><p>Alternative keyword for ‘tip’</p></td>
</tr>
<tr class="row-odd"><td><p>label</p></td>
<td></td>
<td><p>A text label to appear in the line.
Can be styled using HTML tags.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>label</p></td>
<td><p>a text string</p></td>
</tr>
<tr class="row-odd"><td><p>advice</p></td>
<td></td>
<td><p>A text label to appear in italics in
the line. Can be styled using HTML
tags. There should not be anything
else in the line</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>label</p></td>
<td><p>a text string</p></td>
</tr>
<tr class="row-odd"><td><p>subtitle</p></td>
<td></td>
<td><p>A differently-coloured label that can
be used to define sections. Adds a
vertical spacer before it and shows a
tooltip that should be used to
explainthe forthcoming section. Can be
styled using HTML tags. There should
not be anything else in the line</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>label</p></td>
<td><p>a text string for the label</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>tooltip</p></td>
<td><p>a text string for the tooltip</p></td>
</tr>
<tr class="row-even"><td><p>spacing</p></td>
<td></td>
<td><p>Add a non-stretchable space</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>spacing</p></td>
<td><p>Number of pixels</p></td>
</tr>
<tr class="row-even"><td><p>stretch</p></td>
<td></td>
<td><p>Add stretchable space (usually end of
line)</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>stretch factor</p></td>
<td><p>integer (default =1 for widgets and
labels) larger value means more
stretchable</p></td>
</tr>
<tr class="row-even"><td><p>widget</p></td>
<td></td>
<td><p>Add widget to the line</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><em>-qualifier</em></p></td>
<td><p>Note ‘-’ first character. Qualifier
passed as argument to the widget
initialisation method</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>name</p></td>
<td><p>Name of parameter</p></td>
</tr>
</tbody>
</table>
</section>
<section id="toggle-and-togglefunction-arguments">
<h2 id="toggle-and-togglefunction-arguments">toggle and toggleFunction arguments<a class="headerlink" href="#toggle-and-togglefunction-arguments" title="Permalink to this heading">¶</a></h2>
<p>These are arguments to <em>createLine()</em>, <em>openFolder()</em> and
<em>openSubFrame()</em> control whether the line or frame is visible. The
visibility is usually dependent on a parameter in the task container
(for the <em>toggle</em> argument) or, more complex cases (handled by
<em>toggleFunction</em>&gt; have a dependency on multiple parameters and require a
function to be implemented to evaluate and return a logical value. If
controlling the gui appearance requires the definition of some
parameters that are not subsequently used in program wrappers then they
should be put in the <em>guiParameters</em> container in the task definition
file.</p>
<p>The <em>toggle</em> argument is a list of 3 parameters:</p>
<ul class="simple">
<li><p><em>parameter</em> - the name of a parameter in the task container</p></li>
<li><p><em>state</em> - the state of the line or folder i.e. ‘open’ or ‘closed’ if
the parameter has the values..</p></li>
<li><p><em>values</em> - a list of values - default is [True]</p></li>
</ul>
<p>The <em>toggleFunction</em> argument is a list of 2 parameters:</p>
<ul class="simple">
<li><p><em>function</em> - a method returning True if the line should be visible</p></li>
<li><p><em>dependencies</em> - parameters on which the visibility is dependent - it
will be updated if any of these parameters change</p></li>
</ul>
</section>
<section id="accessing-individual-widgets">
<h2 id="accessing-individual-widgets">Accessing individual widgets<a class="headerlink" href="#accessing-individual-widgets" title="Permalink to this heading">¶</a></h2>
<p>It is sometimes necessary to access the individual widgets defined by
<em>createLine()</em> - this can be done by callying <em>getWidget(name)</em> where
<em>name</em> is the name of the paramter. This returns a Qt widget that can be
customised using the standard Qt methods for that widget type (see the
Qt documentation).</p>
</section>
<section id="widget-qualifers">
<h2 id="widget-qualifers">Widget Qualifers<a class="headerlink" href="#widget-qualifers" title="Permalink to this heading">¶</a></h2>
<p>These are arguments to <em>createLine()</em> that are inserted after the
keyword <em>widget</em> and before the name of the parameter that the widget
will represent. For each qualifier the name of the qualifier and the
qualifier value are inserted in the argument list - for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">createLine</span><span class="p">(</span> <span class="p">[</span> <span class="s1">'widget'</span><span class="p">,</span> <span class="s1">'-browseDb'</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">'ABCD'</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<p>The most common qualifiers are:</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Qualifier</p></th>
<th class="head"><p>Widget for data type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-guiLabel</p></td>
<td><p>CDataFile</p></td>
<td><p>A short text label to
appear on the widget</p></td>
</tr>
<tr class="row-odd"><td><p>-browseDb</p></td>
<td><p>CDataFile</p></td>
<td><p>A boolean value. Control
display of icon to browse
the database for files.</p></td>
</tr>
<tr class="row-even"><td><p>-guiMode</p></td>
<td><p>CString,CInt,CFloat which
have enumerator</p></td>
<td><p>Values
‘radio’,’multiLineRadio’
or ‘combo’ determine
presentation of
alternative parameter
values</p></td>
</tr>
<tr class="row-odd"><td><p>-title</p></td>
<td><p>CList</p></td>
<td><p>A short title to appear
at top of a list/tree
widget</p></td>
</tr>
</tbody>
</table>
</section>
<section id="using-the-qt-signals-and-slots">
<h2 id="using-the-qt-signals-and-slots">Using the Qt Signals and Slots<a class="headerlink" href="#using-the-qt-signals-and-slots" title="Permalink to this heading">¶</a></h2>
<p>The main reason to use signals and slots is to cause some code to be run
when the user provides some input. An example of such code might be
resetting defaults dependent on the user’s choice of input file. Qt
signals and slots are explained in detail
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/signalsandslots.html">here</a> but you
only need to know that any Qt object (and, in the context of the gui,
both the data objects and the widgets are Qt objects) emits a signal
when something happens (e.g. a button is clicked or the value of a data
object is changed). Other objects can ‘connect’ to the signal i.e.
request that whenever a particular signal is emited by a particular
object then a particular function is run. The most relevant signal in
CCP4i2 is the <em>dataChanged</em> signal from any data object whenever it is
changed.</p>
<p>The code that you require to run on receiving a signal must be a
separate function, almost certainly a method of your <em>CTaskWidget</em>
subclass. The request to call that function is via the <em>connect()</em>
method and should probably go at the end of task widget <em>drawContents()</em>
method. For example to call the <em>analyseXyzin()</em> method every time the
<em>XYZIN</em> parameter is changed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span>

<span class="o">...</span>
<span class="k">def</span> <span class="nf">drawContents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">createLine</span><span class="p">(</span> <span class="p">[</span>  <span class="s1">'label'</span><span class="p">,</span><span class="s1">'Input model '</span><span class="p">,</span><span class="s1">'widget'</span><span class="p">,</span><span class="s1">'XYZIN'</span> <span class="p">]</span> <span class="p">)</span>

  <span class="o">...</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">inputData</span><span class="o">.</span><span class="n">XYZIN</span><span class="p">,</span><span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s1">'dataChanged'</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">analyseXyzin</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">analyseXyzin</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">analyseXyzin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">inputData</span><span class="o">.</span><span class="n">XYZIN</span><span class="o">.</span><span class="n">isSet</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">inputData</span><span class="o">.</span><span class="n">XYZIN</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span> <span class="k">return</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Beware that the <em>dataChanged</em> signal is also emited when the parameter
has been unset so you need to test carefully (as in the example above)
that the value is valid and may need to unset defaults (or whatever your
function does). Beware also that you may need to call your function
explicitly once when you draw the gui to get things setup initially with
whatever data is initially set.</p>
<p>Note that there is an alternative to calling <em>connect</em> - instead use
<em>CPluginScript.connectDataChanged()</em> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">connectDataChanged</span><span class="p">(</span><span class="s1">'XYZIN'</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">analyseXyzin</span><span class="p">)</span>
</pre></div>
</div>
<p>which is simpler but only applies to <em>dataChanged</em> signals.</p>
<p>Text input widgets can be tricky because the <em>dataChanged</em> signal will
be emitted for every character that the user types and the unfinished
input is probably invalid. An alternative approach for text input is to
use the <em>editingFinished()</em> signal from the actual text input widget -
this is emitted when th user clicks return or moves the focus out of the
widget so suggesting that the input is complete. An example of this
calling <em>setDefaultParameters()</em> every time the user finishes editing
the <em>TEXT</em> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span>  <span class="nf">drawContents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">createLine</span><span class="p">(</span> <span class="p">[</span>  <span class="s1">'label'</span><span class="p">,</span><span class="s1">'Input some text '</span><span class="p">,</span><span class="s1">'widget'</span><span class="p">,</span><span class="s1">'TEXT'</span> <span class="p">]</span> <span class="p">)</span>

  <span class="s1">'''</span>
<span class="s1">  self.connect( self.getWidget('TEXT').widget, QtCore.SIGNAL('editingFinished()'), self.setDefaultParameters )</span>


<span class="s1">def setDefaultParameters(self):</span>
<span class="s1">  ....</span>
</pre></div>
</div>
<p>The <em>getWidget()</em> method is used to get the widget for the <em>TEXT</em>
parameter but note that the actual object connected to is the member
<em>widget</em>. Also note the brackets that are essential in the
<em>editingFinished()</em> signal definition.</p>
</section>
<section id="data-analysis-in-the-task-gui">
<h2 id="data-analysis-in-the-task-gui">Data analysis in the task gui<a class="headerlink" href="#data-analysis-in-the-task-gui" title="Permalink to this heading">¶</a></h2>
<p>The gui code may need to do significant analysis in order to check for
appropriate input or set appropriate default parameters etc.. There is
an example of this in the <a class="reference external" href="../../wrappers/matthews/script/matthews.py">Matthews
task</a> where the results
of an analysis are presented in a text widget.</p>
<p>It is possible to use wrapper scripts from the gui as demonstrated in
the <a class="reference external" href="../../pipelines/crank2/script/CtaskCrank2.py">Crank2 task</a>. The
significant code there is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">CCP4Modules</span><span class="p">,</span><span class="n">CCP4PluginScript</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">workDir</span> <span class="o">=</span> <span class="n">CCP4Modules</span><span class="o">.</span><span class="n">PROJECTSMANAGER</span><span class="p">()</span><span class="o">.</span><span class="n">jobDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobId</span><span class="p">(),</span><span class="n">subDir</span><span class="o">=</span><span class="s1">'TMP'</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
  <span class="n">workDir</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">defaults</span> <span class="o">=</span> <span class="n">CCP4PluginScript</span><span class="o">.</span><span class="n">CPluginScript</span><span class="p">(</span><span class="n">dummy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">workDirectory</span><span class="o">=</span><span class="n">workDir</span><span class="p">)</span><span class="o">.</span><span class="n">makePluginObject</span><span class="p">(</span><span class="n">pluginName</span><span class="o">=</span><span class="s1">'crank2'</span><span class="p">,</span><span class="n">reportToDatabase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
  <span class="k">pass</span>
</pre></div>
</div>
<p>First this code calls <em>PROJECTSMANAGER().jobDirectory()</em> to get the path
of the <em>TMP</em> sub-directory of the appropriate job directory so all files
will be written here. (The <em>TMP</em> sub-directory may be deleted later by
<a class="reference external" href="./pipelines.html#temp">Cleanup</a>.)Then an instance of the
<em>CPluginScript</em> base class is created and the <em>makePluginObject()</em>
method used to create an instance of the required ‘crank2’ wrapper. The
<em>CPluginScript</em> is instantiated with <em>dummy=True</em> that prevents jobs and
files being recorded in the database and the <em>workDirectory</em> is set to
the <em>TMP</em> sub-directory. Sub-tasks of this instance of <em>CPluginScript</em>,
such as the <em>crank2</em> plugin, are then given job-directories in the <em>TMP</em>
directory. The <em>crank2.process()</em> method has an optional <em>container</em>
argument that is passed the current gui container with the current state
of the gui that can be queried by the <em>crank2.process()</em> method.</p>
</section>
<section id="validation-and-changing-parameter-qualifiers">
<h2 id="validation-and-changing-parameter-qualifiers">Validation and changing parameter qualifiers<a class="headerlink" href="#validation-and-changing-parameter-qualifiers" title="Permalink to this heading">¶</a></h2>
<p>The validation of gui input to highlight missing/invalid input and to
check before running a job is done by the widget’s <em>validate()</em> method.
The particular requirements for each data object are specified by
qualifiers of the object that are usually defined in the <em>def</em> file. The
requirements for some parameter may be dependent on other parameters
such that its qualifiers mat need changing by using the
<em>CData.setQualifiers()</em> method. There is an example of this in the
<em>dumMee</em> demo task (
<a class="reference external" href="../../tasks/dummy/CTaskDummy.py">tasks/dummy/CTaskDummy.py</a> can be
seen if the <em>Demo</em> folders on the <a class="reference external" href="#taskmenu">task menu</a> are open).
The behaviour of the PDBIN file parameter is dependent on the
PDBIN_COMPULSARY boolean parameter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">createLine</span> <span class="p">(</span> <span class="p">[</span> <span class="s1">'widget'</span> <span class="p">,</span> <span class="s1">'PDBIN_COMPULSARY'</span> <span class="p">,</span> <span class="s1">'label'</span> <span class="p">,</span><span class="s1">'Model data input is compulsary'</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">createLine</span> <span class="p">(</span> <span class="p">[</span> <span class="s1">'widget'</span><span class="p">,</span><span class="s1">'PDBIN'</span> <span class="p">]</span> <span class="p">)</span>

<span class="bp">self</span><span class="o">.</span><span class="n">connectDataChanged</span><span class="p">(</span><span class="s1">'PDBIN_COMPULSARY'</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">handlePDBIN_COMPULSARY</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">handlePDBIN_COMPULSARY</span><span class="p">()</span>
</pre></div>
</div>
<p>Here the two widgets for <em>PDBIN_COMPULSARY</em> and <em>PDBIN</em> are drawn and
then a <em>connectDataChanged</em> call ensures that <em>handlePDBIN_COMPULSARY()</em>
is called whenever <em>PDBIN_COMPULSARY</em> is changed. There is also an call
to <em>handlePDBIN_COMPULSARY()</em> to initialise the status correctly. The
code in <em>handlePDBIN_COMPULSARY()</em> checks the state of
<em>PDBIN_COMPULSARY</em> and sets the <em>allowUndefined</em> qualifier of <em>PDBIN</em>
appropriately. There is also a call to the <em>validate()</em> method of the
<em>PDBIN</em> widget to ensure the highlightling of the widget is updated.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">handlePDBIN_COMPULSARY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="n">mode</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">inputData</span><span class="o">.</span><span class="n">PDBIN_COMPULSARY</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">inputData</span><span class="o">.</span><span class="n">PDBIN</span><span class="o">.</span><span class="n">setQualifiers</span><span class="p">({</span><span class="s1">'allowUndefined'</span> <span class="p">:</span> <span class="p">(</span><span class="ow">not</span> <span class="n">mode</span><span class="p">)</span> <span class="p">}</span> <span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">getWidget</span><span class="p">(</span><span class="s1">'PDBIN'</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
<p>The behaviour seen in the gui is that if the <em>PDBIN_COMPULSARY</em> checkbox
is checked but there is no valid file selected in the <em>PDBIN</em> widget
then that widget is highlighted.</p>
<p>When the user clicks the <em>Run</em> button the input is validated and if the
validation fails there is an error report and the job run is aborted. By
default the tests are the same validation checks of individual widgets
that lead to widgets being highlighted in red. If the task requires
additional tests, perhaps cross-checking two or more separate widgets,
then you should implement a <em>CTaskWidget.taskValidation()</em> method that
returns a <em>CErrorReport</em>. There is an example of this at the bottom of
<em>dumMee</em> demo task (
<a class="reference external" href="../../tasks/dummy/CTaskDummy.py">tasks/dummy/CTaskDummy.py</a> can be
seen if the <em>Demo</em> folders on the <a class="reference external" href="#taskmenu">task menu</a> are open).
The example tests if the space group in PDB and MTZ file are the same
and returns an error if they are not.</p>
</section>
<section id="auto-generating-guis">
<h2 id="auto-generating-guis">Auto-generating GUIs<a class="headerlink" href="#auto-generating-guis" title="Permalink to this heading">¶</a></h2>
<p>This is a work-in-progress (June 2014) being developed particularly for
generating a gui for MR Phaser. Other interfaces might require
additional features - please contact Liz.</p>
<p>‘Autogenerating’ means creating a GUI from the information in the def
file without any Python coding. When CCP4i2 is run in DEVELOPER mode it
will autogenerate guis from def files for any wrappers which do not have
a specified gui. The same mechanism, generating gui elements from
information in the def file, can be used for some parts of a gui, this
is probably most useful for the more obscure (and perhaps more
changeable) control parameters. We expect that most control parameters
are simple data types (booleans,floats etc) that have widgets defined in
CCP4i2 - more complex data types might need custom written widgets and
guis. An example of including some autogenerated gui is in the
<em>drawContents()</em> method of <em>dumMee</em> demo task (
<a class="reference external" href="../../tasks/dummy/CTaskDummy.py">tasks/dummy/CTaskDummy.py</a> can be
seen if the <em>Demo</em> folders on the <a class="reference external" href="#taskmenu">task menu</a> are open).
The <em>Autogenerated</em> folder is generated by the code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">openFolder</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Autogenerated'</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">autoGenerate</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">controlParameters</span><span class="p">,</span><span class="n">selection</span><span class="o">=</span><span class="p">{</span><span class="s1">'includeParameters'</span> <span class="p">:</span> <span class="p">[</span><span class="s1">'OBSCURE_MODE'</span><span class="p">,</span><span class="s1">'OBSCURE_CUTOFF'</span><span class="p">]})</span>
</pre></div>
</div>
<p>After opening a folder the <em>autoGenerate()</em> method is called with the
arguments: <em>container</em> that is the def file container that is the source
of specifications of parameters and <em>selection</em> that is a Python dict
with several possible keys that specify which parameters in the
container are to be drawn.The <em>includeParameters</em> item lists parameters
to be included in the gui or <em>excludeParameters</em> lists parameters to be
excluded when putting all other parameters from the container in the
gui.</p>
<div class="line-block">
<div class="line">All data classes have three optional qualifiers that help define
presentation in an autogenerated gui:</div>
</div>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Qualifier</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-guiLabel</p></td>
<td><p>A short text label to appear by the widget</p></td>
</tr>
<tr class="row-odd"><td><p>-toolTip</p></td>
<td><p>A longer text description</p></td>
</tr>
<tr class="row-even"><td><p>-guiDefinition</p></td>
<td><p>The xml element contains sub-elements that will be
converted to a Python dict. There is no
restriction on key values but currently used key
values are given below</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br/></div>
</div>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>guiDefinition keys</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>toggleParameter</p></td>
<td><p>Name of a parameter that controls visibility
of the widget in the GUI</p></td>
</tr>
<tr class="row-odd"><td><p>toggleState</p></td>
<td><p>The state (open/closed) for the listed
<em>toggleValues</em> (default is open)</p></td>
</tr>
<tr class="row-even"><td><p>toggleValues</p></td>
<td><p>The values of <em>toggleParameter</em> for which
<em>toggleState</em> applies</p></td>
</tr>
<tr class="row-odd"><td><p>expertLevel</p></td>
<td><p>(Or any arbitary name) can be used in the
selection argument to <em>autoGenerate()</em></p></td>
</tr>
</tbody>
</table>
<p>Related parameters can be grouped into a container and they will then be
displayed in a frame probably with a surrounding border. The visiblity
of the frame will also be toggleable. The container can have the same
qualifiers as listed above for the parameters.</p>
</section>
<section id="multiple-task-interfaces-to-one-wrapper">
<h2 id="multiple-task-interfaces-to-one-wrapper">Multiple Task Interfaces to One Wrapper<a class="headerlink" href="#multiple-task-interfaces-to-one-wrapper" title="Permalink to this heading">¶</a></h2>
<p>Some programs provide multiple functionalities that are used to solve
different problems at different points in the structure solution process
and these are best presented to the user in different task interfaces.
To implement this the developer could provide multiple wrappers to the
one program but one wrapper will be easier to maintain. Typically the
different modes of the program may require different data file inputs
and have different defaults. The input data, defaults etc. are set in
<em>def.xml</em> files and again, to ease maintenance, it would be better to
avoid replication between <em>def.xml</em> files. The solution to this is to
have one ‘base’ <em>def.xml</em> file that specifies all the input, output and
control parameters for the wrapper. A ‘derived’ <em>def.xml</em> file
‘includes’ the ‘base’ <em>def.xml</em> file and then specifies any altered
parameter definitions that will overwrite the ‘base’ definitions. An
example of this is in
<a class="reference external" href="../../tasks/molrep_den/molrep_den.def.xml">ccp4i2/tasks/molrep_den/molrep_den.def.xml</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">ccp4i2_header</span><span class="o">&gt;</span>
  <span class="o">...</span>
  <span class="o">...</span>
  <span class="o">&lt;</span><span class="n">pluginName</span><span class="o">&gt;</span><span class="n">molrep_den</span><span class="o">&lt;/</span><span class="n">pluginName</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">pluginTitle</span><span class="o">&gt;</span><span class="n">Fitting</span> <span class="n">to</span> <span class="n">a</span> <span class="nb">map</span> <span class="n">using</span> <span class="n">Molrep</span><span class="o">&lt;/</span><span class="n">pluginTitle</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">jobId</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">ccp4i2_header</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">ccp4i2_body</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"molrep_den"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">CI2XmlDataFile</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">project</span><span class="o">&gt;</span><span class="n">CCP4I2_TOP</span><span class="o">&lt;/</span><span class="n">project</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">relPath</span><span class="o">&gt;</span><span class="n">wrappers</span><span class="o">/</span><span class="n">molrep_mr</span><span class="o">/</span><span class="n">script</span><span class="o">&lt;/</span><span class="n">relPath</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">baseName</span><span class="o">&gt;</span><span class="n">molrep_mr</span><span class="o">.</span><span class="n">def</span><span class="o">.</span><span class="n">xml</span><span class="o">&lt;/</span><span class="n">baseName</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">CI2XmlDataFile</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">container</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"inputData"</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">content</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"F_SIGF"</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">className</span><span class="o">&gt;</span><span class="n">CObsDataFile</span> <span class="o">&lt;/</span><span class="n">className</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">qualifiers</span><span class="o">&gt;</span>
 <span class="o">...</span>
 <span class="o">...</span>
</pre></div>
</div>
<p>Here the <em>molrep_den</em> def file is ‘derived’ from the <em>molrep_mr</em> def
file. The file/CI2XmlDataFile element specifies the file path for a
‘base’ def.xml file and the rest of this file contains specification of
only a few parameters that are different between <em>molrep_den</em> and
<em>molrep_mr</em>.</p>
<p>The <em>molrep_den</em> GUI definition in
<a class="reference external" href="../../tasks/molrep_den/Cmolrep_den.py">ccp4i2/tasks/molrep_den/Cmolrep_den.py</a>
must also contain an additional class parameter <em>GUINAME</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Cmolrep_den</span><span class="p">(</span><span class="n">CCP4TaskWidget</span><span class="o">.</span><span class="n">CTaskWidget</span><span class="p">):</span>

  <span class="n">TASKTITLE</span><span class="o">=</span><span class="s1">'Search density using Molrep'</span>
  <span class="n">TASKNAME</span> <span class="o">=</span> <span class="s1">'molrep_mr'</span>
  <span class="n">GUINAME</span> <span class="o">=</span> <span class="s1">'molrep_den'</span>
  <span class="n">TASKMODULE</span><span class="o">=</span><span class="s1">'model_building'</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Note that the <em>TASKNAME</em> is the name of the script that this GUI will
run and <em>GUINAME</em> is the unique name for this GUI which should matchup
with the <em>pluginName</em> in the header of the <em>def.xml</em> file. (In case you
are wondering, for most GUIs the <em>GUINAME</em> is assumed to be the same as
the <em>TASKNAME</em>.)</p>
</section>
<section id="the-task-menu">
<h2 id="the-task-menu">The Task Menu<a class="headerlink" href="#the-task-menu" title="Permalink to this heading">¶</a></h2>
<p>The task menu in the gui is populated automatically at startup by taking
information from the <em>CTaskWidget</em> subclasses. The modules presented in
the menu are listed at the top of
<a class="reference external" href="../../core/CCP4TaskManager.py">ccp4i2/core/CCP4TaskManager.py</a>. The
<em>CTaskWidget</em> class attributes that determine the menu are:</p>
<table>
<tbody>
<tr class="row-odd"><td><p><strong>CTaskWidget Class Attributes</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>TASKNAME</p></td>
<td><p>The obligatory name of the
script essential for
cross-refererence to other files</p></td>
</tr>
<tr class="row-odd"><td><p>TASKVERSION</p></td>
<td><p>A version number for the script.
Please give one!</p></td>
</tr>
<tr class="row-even"><td><p>TASKMODULE</p></td>
<td><p>Refers to where the task should
appear in the task menu, can be
list of multiple modules</p></td>
</tr>
<tr class="row-odd"><td><p>TASKTITLE</p></td>
<td><p>The name for the task to appear
in the GUI</p></td>
</tr>
<tr class="row-even"><td><p>DESCRIPTION</p></td>
<td><p>More details to appear in the
GUI</p></td>
</tr>
</tbody>
</table>
<p>Note that tasks under developement should be put in the <em>wrapper</em> or
<em>test</em> module and the developer can make these modules visible in the
gui by ticking the preferences check-box:
<code class="docutils literal notranslate"><span class="pre">Preferences</span> <span class="pre">-&gt;</span> <span class="pre">Advanced</span> <span class="pre">-&gt;</span> <span class="pre">Show</span> <span class="pre">testing/development</span> <span class="pre">tasks</span></code>
.</p>
<div class="line-block">
<div class="line">The preferred style for title and description can be inferred from the
existing menu but:</div>
<div class="line">The title should be short - remember it will appear in the left-hand
job list as well. The names of programs should not appear unless
really necessary to distinguish similar tasks.</div>
<div class="line">The description should amplify on the functionality and include names
of key programs run.</div>
</div>
<p>The icon on the menu is taken from a file
<em>ccp4i2/qticons/</em>TASKNAME<em>.png</em>.These image files should have
resolution at least 32x32 and are currently also displayed at 24x24 in
the ‘Compact’ style - see <em>Preferences</em>.</p>
</section>
<section id="creating-child-pop-out-task-gui">
<h2 id="creating-child-pop-out-task-gui">Creating Child Pop-out Task GUI<a class="headerlink" href="#creating-child-pop-out-task-gui" title="Permalink to this heading">¶</a></h2>
<p>This is a facility to put a button in the task window that creates
another task gui in a pop-out window. The parent <em>CTaskWidget</em> class
should also reimplement the <em>CTaskWidget.handleLaunchedJob()</em> method
which is called when the child job is created and when it has finished
running. There is an example in
<a class="reference external" href="../../tasks/dummy/CTaskDummy.py">tasks/dummy/CTaskDummy.py</a> which
creates a launch button for the <em>Gesamt</em> task. The result can be seen in
the <em>Create New Job</em> folder of the <em>dumMee</em> task (only visble if the
<em>Demo</em> folders on the <a class="reference external" href="#taskmenu">task menu</a> are open). The
hypothetical scenario is that the user needs to reposition the input
coordinate file by superposing on another model before continuing with
this task. The button to lauch and alternative task is defined by the
<em>launchButton</em> keyword input to <em>createLine()</em> and it should be followed
by the name of the task to be opened. In the example code below the
<em>XYZIN</em> input widget and the lauch button are drawn. A <em>connect()</em> call
is used to ensure that <em>updateLauchButton()</em> is called whenever the
value of <em>XYZIN</em> is changed and this is also called immediately in order
to disable the launch button if <em>XYZIN</em> is unset.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">createLine</span><span class="p">([</span><span class="s1">'label'</span><span class="p">,</span><span class="s1">'Enter a coordinate file to test launch job button'</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">createLine</span><span class="p">([</span><span class="s1">'widget'</span><span class="p">,</span><span class="s1">'XYZIN'</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">createLine</span><span class="p">([</span><span class="s1">'label'</span><span class="p">,</span><span class="s1">'Superpose the coordinates on another model by'</span><span class="p">,</span><span class="s1">'launchButton'</span><span class="p">,</span><span class="s1">'gesamt'</span><span class="p">])</span>
<span class="c1"># Update the status of the lauch button dependent on selection of XYZIN</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">inputData</span><span class="o">.</span><span class="n">XYZIN</span><span class="p">,</span><span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s1">'dataChanged'</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">updateLauchButton</span><span class="p">)</span>
<span class="c1"># .. and initialise its status</span>
<span class="bp">self</span><span class="o">.</span><span class="n">updateLauchButton</span><span class="p">()</span>
</pre></div>
</div>
<p>The code to enable/disable the launch button:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">updateLauchButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="c1"># Enable the launch button dependent on whether XYZIN is set</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">,</span><span class="s1">'gesamt'</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">inputData</span><span class="o">.</span><span class="n">XYZIN</span><span class="o">.</span><span class="n">isSet</span><span class="p">())</span>
</pre></div>
</div>
<p>Note that the <em>findChild()</em> method is used to get a reference to the
launch button. The launch button has been created with its object name
set to the name of the task to be launched and this is the second
argument to <em>findChild()</em>.</p>
<p>You should also implement an <em>updateLauchButton()</em> method which will be
called twice: firstly when the child task window is created and the
input <em>status</em> value is 1 (Pending - see top of
<a class="reference external" href="../../dbapi/CCP4DbApi.py">dbapi/CCP4DbApi.py</a> file) and then when
the job has finished so status is 6 (Finished) or 5 (Failed). Both calls
also pass the <em>jobId</em> but only the first call passes the a reference to
the new task widget; beware the task widget may have been closed by the
time the job finishes. The example code shows how to copy data from the
current task wigdet into the newly launched task widget and then how to
get information on job output files from the database in order to use it
in the current gui.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">handleLaunchedJob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">jobId</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">taskWidget</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="c1"># If this is called with status=1=Pending the taskWidget (gesamt window) has just been opened</span>
  <span class="c1"># and we can set a value in it</span>
  <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">taskWidget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">taskWidget</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">inputData</span><span class="o">.</span><span class="n">XYZIN_QUERY</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">inputData</span><span class="o">.</span><span class="n">XYZIN</span><span class="p">)</span>
  <span class="c1"># Status is 6 (Finished)</span>
  <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
    <span class="c1"># Can not assume that the gesamt widget is still there - must instead query the database for output file</span>
    <span class="c1"># Use CDbApi.getJobFilesInfo() which returns a list of dicts containing description of files output by the job</span>
    <span class="c1"># The best way to set the file object ot a new value is by setDbFileId()</span>
    <span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">CCP4Modules</span>
    <span class="n">gesamtFileList</span> <span class="o">=</span> <span class="n">CCP4Modules</span><span class="o">.</span><span class="n">PROJECTSMANAGER</span><span class="p">()</span><span class="o">.</span><span class="n">db</span><span class="p">()</span><span class="o">.</span><span class="n">getJobFilesInfo</span><span class="p">(</span><span class="n">jobId</span><span class="o">=</span><span class="n">jobId</span><span class="p">,</span><span class="n">jobParamName</span><span class="o">=</span><span class="s1">'XYZOUT'</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gesamtFileList</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">getWidget</span><span class="p">(</span><span class="s1">'XYZIN'</span><span class="p">)</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setDbFileId</span><span class="p">(</span><span class="n">gesamtFileList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'fileId'</span><span class="p">])</span>
</pre></div>
</div>
<p>There are some possible problems that are not trapped here - what if the
user changes the <em>XYZIN</em> in the current gui but still runs the <em>gesamt</em>
task? An exercise for the reader perhaps?</p>
</section>
<section id="speeding-drawing-of-tasks">
<h2 id="speeding-drawing-of-tasks">Speeding drawing of tasks<a class="headerlink" href="#speeding-drawing-of-tasks" title="Permalink to this heading">¶</a></h2>
<p>Complex task inputs take a significant amount of time to draw which can
be reduced by drawing only the top ‘Data input’ tab when the task is
opened and drawing other tabs on demand. To implement this the
<em>openFolder()</em> call should have a <em>drawFolder</em> argument that is the
method to draw the contents of the folder. So in the aimless task:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">drawContents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">openFolder</span><span class="p">(</span><span class="n">folderFunction</span><span class="o">=</span><span class="s1">'inputData'</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">'Input Data'</span><span class="p">)</span>
    <span class="c1">#define the Input data folder here</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">openFolder</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Important Options'</span><span class="p">,</span><span class="n">drawFolder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">drawImportant</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">openFolder</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'AdditionaOptions'</span><span class="p">,</span><span class="n">drawFolder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">drawAdditional</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">drawImportant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#define the 'Important Options' folder here</span>


<span class="k">def</span> <span class="nf">drawAdditional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#define the 'Additional Options' folder here</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">There are likely to be additional issues:</div>
<div class="line">Code to initialise gui status may need to be put in an appropriate
<em>drawFolder</em> method.</div>
<div class="line">It may be necessary to test whether a given widget is already drawn by
calling <em>CTaskWidget.getWidget(PARAMNAME)</em> which wil return <em>None</em> if
the widget for <em>PARAMNAME</em> is not yet drawn. There are potential
problems if the ‘toggle’ status (visible/invisible) of a line or
subfolder is dependent on parameters in another folder other than the
top ‘Input data’ folder. This is not a nice feature anyway.</div>
</div>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="CCP4i2_DB_Recovery.html" title="Database Recovery Guide"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Database Recovery Guide </span>
              </div>
            </a>
          
          
            <a href="pipelines.html" title="CCP4I2 Developers: Wrappers and Pipelines"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> CCP4I2 Developers: Wrappers and Pipelines </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2020, CCP4.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.2.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>