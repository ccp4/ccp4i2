
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#00020a">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>CCP4I2 Developers Data Classes and Containers &#8212; CCP4i2  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/contentui.css" />
    <link rel="stylesheet" type="text/css" href="https://github.com/bwithd/sphinx-material/blob/main/sphinx_material/sphinx_material/static/stylesheets/application.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/contentui.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CCP4i2 Data Classes" href="modules/index.html" />
    <link rel="prev" title="CCP4I2 Developers Error Handling" href="error_handling.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=#005BBB data-md-color-accent=yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500" id="__gitlab"><path fill="currentColor" d="M93.667 473.347l90.684-279.097H2.983l90.684 279.097z" transform="translate(156.198 1.16)"/><path fill="currentColor" d="M221.333 473.345L130.649 194.25H3.557l217.776 279.095z" transform="translate(28.531 1.16)" opacity=".7"/><path fill="currentColor" d="M32 195.155L4.441 279.97a18.773 18.773 0 0 0 6.821 20.99l238.514 173.29L32 195.155z" transform="translate(.089 .256)" opacity=".5"/><path fill="currentColor" d="M2.667-84.844h127.092L75.14-252.942c-2.811-8.649-15.047-8.649-17.856 0L2.667-84.844z" transform="translate(29.422 280.256)"/><path fill="currentColor" d="M2.667 473.345L93.351 194.25h127.092L2.667 473.345z" transform="translate(247.198 1.16)" opacity=".7"/><path fill="currentColor" d="M221.334 195.155l27.559 84.815a18.772 18.772 0 0 1-6.821 20.99L3.557 474.25l217.777-279.095z" transform="translate(246.307 .256)" opacity=".5"/><path fill="currentColor" d="M130.667-84.844H3.575l54.618-168.098c2.811-8.649 15.047-8.649 17.856 0l54.618 168.098z" transform="translate(336.974 280.256)"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#developers/data_classes" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="CCP4i2  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">CCP4i2  documentation</span>
          <span class="md-header-nav__topic"> CCP4I2 Developers Data Classes and Containers </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">CCP4i2  documentation</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Developer Notes</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="CCP4i2 documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="CCP4i2 documentation">CCP4i2  documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
    </div>
  
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#developers-data-classes--page-root" class="md-nav__link">CCP4I2 Developers Data Classes and Containers</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#data-classes" class="md-nav__link">Data Classes</a>
        </li>
        <li class="md-nav__item"><a href="#the-container-class" class="md-nav__link">The Container Class</a>
        </li>
        <li class="md-nav__item"><a href="#creating-a-new-file-type" class="md-nav__link">Creating a New File Type</a>
        </li>
        <li class="md-nav__item"><a href="#file-content-classes-and-contentflag-and-subtype-flags" class="md-nav__link">File content classes and <em>contentFlag</em> and <em>subType</em> flags</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/developers/data_classes.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="ccp4i2-developers-data-classes-and-containers">
<h1 id="developers-data-classes--page-root">CCP4I2 Developers Data Classes and Containers<a class="headerlink" href="#developers-data-classes--page-root" title="Permalink to this heading">¶</a></h1>
<section id="data-classes">
<h2 id="data-classes">Data Classes<a class="headerlink" href="#data-classes" title="Permalink to this heading">¶</a></h2>
<p>All data classes are sub-classed from <em>CCP4Data.CData</em>. The same classes
are used by the gui and pipelines. The <em>CCP4Data.CData</em> (in core
directory) currently subclasses either<em>CCP4QtObject.CObject</em> or
<em>CCP4Object.CObject</em>. The first of these subclasses the Qt class
<em>QtCore.QObject</em> which provides <a class="reference external" href="http://doc.qt.nokia.com/4.6/signalsandslots.html">signals and
slots</a>
functionality. The second is intended as an alternative to Qt dependence
but is not yet implemented.</p>
<p>The <em>CCP4Data.CBaseData</em> class sub-classes CData and is the base class
for all ‘simple’ data classes that hold one item of data.</p>
<p>Currently the data classes are in:</p>
<ul class="simple">
<li><p>CCP4Data - general data</p></li>
<li><p>CCP4XtalData MX experimental data</p></li>
<li><p>CCP4ModelData MX model data</p></li>
<li><p>CCP4Files - files and XML handling</p></li>
<li><p>CCP4Annotation - annotation and meta data</p></li>
<li><p>CCP4MathsData - basic maths</p></li>
</ul>
<p>There is a GUI widget for each data class - there is not necessarilly a
simple ono-to-one relationship - each widget class has a MODEL_CLASS
parameter which lists which data classes it can represent. The gui
classes are in the <em>qtgui</em> directory.</p>
<p>To enable easy XML input/output of data all data classes have methods to
get and set an eTree representation of their data content. The eTree
functionality is provided by <em>lxml</em> - see <a class="reference external" href="http://codespeak.net/lxml/.The">http://codespeak.net/lxml/.The</a>
eTree representation is easily imported from or exported as XML.</p>
<p>All CData classes have a few class-wide attributes that are usually
defined at the top of the class. These are:</p>
<table>
<tbody>
<tr class="row-odd"><td><p><strong>Attribute</strong></p></td>
<td><p><strong>Format</strong></p></td>
<td><p><strong>Function</strong></p></td>
</tr>
<tr class="row-even"><td><p>CONTENTS</p></td>
<td><p>Dictionary, keys are
sub-object names and
values are
dictionaries with at
least a <em>class</em> key.</p></td>
<td><p>The contents of
‘complex’ classes</p></td>
</tr>
<tr class="row-odd"><td><p>PYTHONTYPE</p></td>
<td><p>A Python type</p></td>
<td><p>The Python type for
simple data classes</p></td>
</tr>
<tr class="row-even"><td><p>QUALIFIERS</p></td>
<td><p>Dictionary, keys are
qualifier names, and
values are
appropriate type for
the qualifier.</p></td>
<td><p>Specify the default
qualifiers for this
class. This can be
over-ridden for any
instance of the
class.</p></td>
</tr>
<tr class="row-odd"><td><p>QUALIFIERS_ORDER</p></td>
<td><p>A list of qualifier
names</p></td>
<td><p>The order qualifiers
will apppear in
defEd GUI.</p></td>
</tr>
<tr class="row-even"><td><p>QUALIFIERS_DEFINITION</p></td>
<td><p>Dictionary, keys are
qualifier names,
values are a
dictionary with at
least keys: <em>type</em> -
a Python type and
<em>description</em> - a
brief description
for defEd GUI.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>ERROR_CODES</p></td>
<td><p>Dictionary</p></td>
<td><p>Described above</p></td>
</tr>
<tr class="row-even"><td><p>PROPERTIES</p></td>
<td><p>Dictionary with keys
are property name
and value is
dictionary with
<em>fget</em> and <em>fset</em>
keys.</p></td>
<td><p>Analogous to the
Python <em>property</em>
command. This must
be placed after the
methods for <em>fget</em>
and <em>fset</em>.</p></td>
</tr>
</tbody>
</table>
<p>These attributes should be accessed by methods such as <em>contents()</em> and
<em>qualifier()</em> rather than accessed directly. The access methods
implement the principle that sub-classes inherit the properties of base
classes and that the QUALIFIER attributes can be over-ridden in
particular class instances.</p>
<p>The following table explains the main class methods - it is not
comprehensive documentation.</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>CData method</p></th>
<th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>__init__</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>parent</p></td>
<td><p>The Qt system expects
each QObject to have a
parent QObject with the
first ancestor object
being the Qt
QApplication. The
CC
P4Modules.QTAPPLICATION()
function will return the
QApplication if you need
it but the usual parent
of CData should be the
<em>CContainer</em> that holds
the data.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>qualifiers</p></td>
<td><p>A dictionary of
parameters to ‘fine-tune’
the class - particularly
specifying validation
parameters such as
maximum or minimum
allowed values. This
mechanism is intended to
reduce the need for
sub-classing. The allowed
values can be seen in the
__init__ method. The
CData base class expects
two parameters: a <em>name</em>
and a <em>default</em> value.
The name is the same as
the element tag in the
XML representation of the
class. The default
<em>default</em> value is the
Python <em>None</em> (i.e. not
set).</p></td>
</tr>
<tr class="row-odd"><td><p>parent</p></td>
<td></td>
<td><p>Return the parent object.</p></td>
</tr>
<tr class="row-even"><td><p>objectName</p></td>
<td></td>
<td><p>Return the object’s name.</p></td>
</tr>
<tr class="row-odd"><td><p>objectPath</p></td>
<td></td>
<td><p>Return a ‘path’ name
incuding parent object
names. An underscore
separator is used.</p></td>
</tr>
<tr class="row-even"><td><p>getEtree</p></td>
<td></td>
<td><p>Return an eTree element
representing the data
object.</p></td>
</tr>
<tr class="row-odd"><td><p>setEtree</p></td>
<td></td>
<td><p>Parse an eTree element
and initialise the data
object.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>element</p></td>
<td><p>An etree element</p></td>
</tr>
<tr class="row-odd"><td><p>set</p></td>
<td></td>
<td><p>Set the data. The method
calls the <em>validity</em>
method and will only set
the data if the validity
is OK. setData returns a
CErrorReport from
validity().</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>data</p></td>
<td><p>The set method attempts
to be very tolerant of
input e.g. <em>i = CInt();
i.set(‘12’)</em> is
acceptable. Simple, one
item, data objects expect
the appropriate Python
type or the appropriate
CData class as argument
to set. Complex, multi
item, data objects,
expect Python
dictionaries or the
different components on
the command line. See the
<a href="#id1"><span class="problematic" id="id2">`</span></a>example
code</p>
<blockquote>
<div><p>&lt;./example_code.html&gt;`__</p>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><p>unSet</p></td>
<td></td>
<td><p>Unset the data</p></td>
</tr>
<tr class="row-even"><td><p>get</p></td>
<td></td>
<td><p>Return the data contents
on the object. For a
simple class with single
item then that is
returned; if the data has
multiple items then they
are returned as a Python
dictionary.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>name</p></td>
<td><p>Optional name of one item
in a multi-item data
class. If this is set
then only the named item
is returned.</p></td>
</tr>
<tr class="row-even"><td><p>validity</p></td>
<td></td>
<td><p>Return a <em>CErrorReport</em>
indicating validity of
input data.</p></td>
</tr>
<tr class="row-odd"><td><p>fix</p></td>
<td></td>
<td><p>Return a dictionary
representation of the
class data that has been
fixed (possibly with
significant change to
content) to be valid.
This method is only
useful where it has been
reimplemented in some
sub-classes.</p></td>
</tr>
<tr class="row-even"><td><p>isSet</p></td>
<td></td>
<td><p>Return <em>False</em>/ <em>True</em>
dependent on whether the
data is set or is a null
value.</p></td>
</tr>
<tr class="row-odd"><td><p>emitDataChanged</p></td>
<td></td>
<td><p>A wrapper for the Qt
QObject.emit() method to
emit a ‘dataChanged’
signal.</p></td>
</tr>
<tr class="row-even"><td><p>setQualifiersEtree</p></td>
<td></td>
<td><p>Parse an etree element
containing the qualifiers
for the class. This is
used when the data type
definitions are read from
an XML file. Return a
<em>CErrorReport</em></p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>element</p></td>
<td><p>etree element.</p></td>
</tr>
<tr class="row-even"><td><p>getQualifiersEtree</p></td>
<td></td>
<td><p>Return a tuple of an
eTree element containing
the data qualifiers for
the class and a
<em>CErrorReport</em></p></td>
</tr>
<tr class="row-odd"><td><p>contents</p></td>
<td></td>
<td><p>Return a dictionary
specifying the contents
of a complex class</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>name</p></td>
<td><p>Name of one item in the
class. If this is set
then returns definition
of just that item.</p></td>
</tr>
<tr class="row-odd"><td><p>qualifiers</p></td>
<td></td>
<td><p>Return a dictionary of
qualifier values for the
class.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>name</p></td>
<td><p>The name of a qualifier.
Return the value of that
qualifier only.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>default</p></td>
<td><p>If False do not return
the qualifiers that have
the default value for the
class</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>custom</p></td>
<td><p>If False do not return
the qualifiers that have
the been customised in
this instance of the
class</p></td>
</tr>
<tr class="row-odd"><td><p>qualifiersDefinition</p></td>
<td></td>
<td><p>Return the definition of
the qualifiers for the
class</p></td>
</tr>
<tr class="row-even"><td><p>pythonType</p></td>
<td></td>
<td><p>Return the Python type
equivalent for a simple
class</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>name</p></td>
<td><p>The name of a qualifier.
Return the definition of
that qualifier only.</p></td>
</tr>
<tr class="row-even"><td><p>qualifiersOrder</p></td>
<td></td>
<td><p>Return the order of the
qualifiers used in a GUI.</p></td>
</tr>
<tr class="row-odd"><td><p>setDefault</p></td>
<td></td>
<td><p>Set the data to the
default value.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="the-container-class">
<h2 id="the-container-class">The Container Class<a class="headerlink" href="#the-container-class" title="Permalink to this heading">¶</a></h2>
<p><em>CCP4Container.CContainer</em> is a sub-class of <em>CData</em> which differs
mostly in that its data contents (for most<em>CData</em> defined bt the
CONTENTS attribute) are defined at run time. The container holds a set
of data objects in a Python dictionary. Typically one container is
associated with one gui window or one program wrapper. The data
container classes are not sub-classed - their contents are specified
when the class is instantiated. The data objects within the container
apply their <em>validity()</em> method to ensure that all loaded data is valid.
A data container may contain sub-containers.</p>
<p>Typically the content of a <em>CContainer</em> is defined in a DEF (extension
<em>def.xml</em>) file and its data is imported from and exported to PARAMS
(extension <em>params.xml</em>) files. When the content definition is read the
data objects to hold the data are created automatically.</p>
<p>Containers are the Python representation of PARAMS files and these files
contain a header holding meta-data such as creation date and project id.
The header can be accessed as <em>myContainer.header</em> and is a
CCP4File:CI2XmlHeader class. Tasks developers should not normally need
to access this data as it is handled by the CCP4i2 core.</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>loadContentsFromXml</p></td>
<td></td>
<td><p>Load the content
definition from a DEF
file. Returns a
CErrorReport.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>fileName</p></td>
<td><p>The full path name of a
file</p></td>
</tr>
<tr class="row-even"><td><p>loadDataFromXml</p></td>
<td></td>
<td><p>Load the data values
from a PARAMS file.
Should only be used
after the contents have
been defined.Returns a
CErrorReport.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>fileName</p></td>
<td><p>The full path name of a
file</p></td>
</tr>
<tr class="row-even"><td><p>saveContentsToXml</p></td>
<td></td>
<td><p>Save the content
definition to a DEF
file.Returns a
CErrorReport.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>fileName</p></td>
<td><p>The full path name of a
file</p></td>
</tr>
<tr class="row-even"><td><p>saveDataToXml</p></td>
<td></td>
<td><p>Save the data values to
a PARAMS file.Returns a
CErrorReport.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>fileName</p></td>
<td><p>The full path name of a
file</p></td>
</tr>
<tr class="row-even"><td><p>loadContentsFromEtree</p></td>
<td></td>
<td><p>Load the content
definition from an eTree
element</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>element</p></td>
<td><p>An eTree element</p></td>
</tr>
<tr class="row-even"><td><p>loadDataFromEtree</p></td>
<td></td>
<td><p>Load the data values
from an eTree element.
Should only be used
after the contents have
been defined.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>element</p></td>
<td><p>An eTree element</p></td>
</tr>
<tr class="row-even"><td><p>saveContentsToEtree</p></td>
<td></td>
<td><p>Return a Python tuple of
an eTree element
representing the
contents and a
CErrorReport.</p></td>
</tr>
<tr class="row-odd"><td><p>saveDataToEtree</p></td>
<td></td>
<td><p>Return a Python tuple of
an eTree element
representing the data
values and a
CErrorReport.</p></td>
</tr>
<tr class="row-even"><td><p>addContent</p></td>
<td></td>
<td><p>The arguments to this
method define a data
object. The method
creates a new object and
appends it to the
container.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>name</p></td>
<td><p>A name for the new data
object</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>cls</p></td>
<td><p>The class of the new
data object</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>qualifiers</p></td>
<td><p>A Python dictionary of
qualifiiers for the new
object</p></td>
</tr>
<tr class="row-even"><td><p>addObject</p></td>
<td></td>
<td><p>Add an already existing
data object ot the
container</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>name</p></td>
<td><p>A name for the new data
object</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>object</p></td>
<td><p>The CData object</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>afterObject</p></td>
<td><p>Insert the new object in
the container after the
object with this name.</p></td>
</tr>
<tr class="row-even"><td><p>replaceObject</p></td>
<td></td>
<td><p>Replace a data object
with given name by
another existing object</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>name</p></td>
<td><p>The name of an existing
data object in the
container</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>object</p></td>
<td><p>A CData object</p></td>
</tr>
<tr class="row-odd"><td><p>deleteObject</p></td>
<td></td>
<td><p>Delete an object with
given name</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>name</p></td>
<td><p>The name of an existing
data object in the
container</p></td>
</tr>
<tr class="row-odd"><td><p>renameObject</p></td>
<td></td>
<td><p>Rename an object</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>oldName</p></td>
<td><p>The name of an existing
data object in the
container</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>newName</p></td>
<td><p>A new name</p></td>
</tr>
<tr class="row-even"><td><p>clear</p></td>
<td></td>
<td><p>remove all content from
the comtainer</p></td>
</tr>
<tr class="row-odd"><td><p>dataOrder</p></td>
<td></td>
<td><p>Return a list of all the
names of data objects
(and sub-containers) in
the container</p></td>
</tr>
<tr class="row-even"><td><p>addHeader</p></td>
<td></td>
<td><p>Add a CCP4File.CHeader
header to the container.
This header can be set
appropriately prior to
exporting an XML file.</p></td>
</tr>
<tr class="row-odd"><td><p>parseCommandLine</p></td>
<td></td>
<td><p>Load data into the
container by parsing a
‘command line’ formatted
asa list of words</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>commandLine</p></td>
<td><p>A list of words such as
returned by sys.argv()</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>template</p></td>
<td><p>Optional template for
interpreting command
line (<a class="reference external" href="#command%20line">more
in
fo</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="creating-a-new-file-type">
<h2 id="creating-a-new-file-type">Creating a New File Type<a class="headerlink" href="#creating-a-new-file-type" title="Permalink to this heading">¶</a></h2>
<p>This is a brief how-to - mostly to remind Liz.</p>
<p>To register a new file type in CCP4i2 it needs to be added in three
different places (no, that’s not good but at least its documented!):</p>
<ul class="simple">
<li><p>A sub-class of <em>CCP4DataFile.CDataFile</em> should be created so there is
an appropriate data object.</p></li>
<li><p>It should be added to the mimetypes in <em>CCP4CustomMimeTypes</em> so the
Qt file display and drag-n-drop can handle the files.</p></li>
<li><p>It should be registered with the database by adding to lists in
<em>CCP4DbApi</em>.</p></li>
<li><p>Also a file icon should be provided in the <em>qticons</em> directory.</p></li>
</ul>
<p>A simple file class definition might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CPhaserSolDataFile</span><span class="p">(</span><span class="n">CCP4File</span><span class="o">.</span><span class="n">CDataFile</span><span class="p">):</span>

<span class="n">QUALIFIERS</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'mimeTypeName'</span> <span class="p">:</span> <span class="s1">'application/phaser-sol'</span><span class="p">,</span>
<span class="s1">'mimeTypeDescription'</span> <span class="p">:</span> <span class="s1">'Phaser solution file'</span><span class="p">,</span>
<span class="s1">'fileExtensions'</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">'phaser_sol.pkl'</span> <span class="p">],</span>
<span class="s1">'fileContentClassName'</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">'fileLabel'</span> <span class="p">:</span> <span class="s1">'phaser_sol'</span><span class="p">,</span>
<span class="s1">'guiLabel'</span> <span class="p">:</span> <span class="s1">'Phaser solution file'</span><span class="p">,</span>
<span class="s1">'toolTip'</span> <span class="p">:</span> <span class="s2">"Possible solutions passed between runs of the Phaser program"</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the <em>mimeTypeName</em> must match the mime type in
<em>CCP4CustomMimeTypes</em>, <em>CCP4DbApi</em>. The <em>fileContentClassName</em> is not
set here but if i2 needs to read the file then a file content class that
sub-classes <em>CCP4File.CDataFileContent</em> should be implemented and the
class name provided here as a string.</p>
<p>A definition of the mime type looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimeType</span> <span class="o">=</span> <span class="n">CMimeType</span><span class="p">()</span>
<span class="n">mimeType</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"application/phaser-sol"</span>
<span class="n">mimeType</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">"Phaser solution file"</span>
<span class="n">mimeType</span><span class="o">.</span><span class="n">fileExtensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'phaser_sol.pkl'</span><span class="p">]</span>
<span class="n">mimeType</span><span class="o">.</span><span class="n">viewers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mimeType</span><span class="o">.</span><span class="n">icon</span> <span class="o">=</span> <span class="s1">'PhaserSolDataFile'</span>
<span class="n">mimeType</span><span class="o">.</span><span class="n">className</span> <span class="o">=</span> <span class="s1">'PhaserSolDataFile'</span>
<span class="bp">self</span><span class="o">.</span><span class="n">mimeTypes</span><span class="p">[</span><span class="s2">"application/phaser-sol"</span><span class="p">]</span> <span class="o">=</span> <span class="n">mimeType</span>
</pre></div>
</div>
<p>Note that the <em>className</em> should cross reference the class name and by
default the system assumes the file icon is the class name but an
alternative can be provided here to be used in the file browser. Note
that the className and icon have dropped the leading ‘C’.</p>
<p>In the database file <em>CCP4DbApi</em> it is necessary to add the file type to
three lists:</p>
<ul class="simple">
<li><p>FILETYPES_TEXT - this is a list of the mime types</p></li>
<li><p>FILETYPES_CLASS - a list of file class names without the initial ‘C’</p></li>
<li><p>FILETYPELIST - a list of items with each element being a list of
three items: a file type number, the mime type name and a short
description.</p></li>
</ul>
<p>It is imperative to keep these three lists in sync! Also if a file type
is added to the list and then subsequently not required the slot should
not be deleted or reused - it should just be left as a ‘dummy’ the same
as file type 14.</p>
</section>
<section id="file-content-classes-and-contentflag-and-subtype-flags">
<h2 id="file-content-classes-and-contentflag-and-subtype-flags">File content classes and <em>contentFlag</em> and <em>subType</em> flags<a class="headerlink" href="#file-content-classes-and-contentflag-and-subtype-flags" title="Permalink to this heading">¶</a></h2>
<p>The classes derived from <em>CDataFile</em> such as <em>CPdbDataFile</em> and the
various forms of mini MTZ such as <em>CObsDataFile</em> basically serve as a
reference to the data file holding the file path and some additional
flags discussed later. A <em>fileContent</em> class such as <em>CPdbData</em> or
<em>CMtzData</em> can hold some data extracted from the file. A example of
using these:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">CCP4XtalData</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mtzData</span> <span class="o">=</span> <span class="n">CCP4XtalData</span><span class="o">.</span><span class="n">CMtzDataFile</span><span class="p">(</span><span class="s1">'/y/people/lizp/rnase25.mtz'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fileContent</span><span class="p">)</span>
<span class="go">&lt;class 'CCP4XtalData.CMtzData'&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">f</span><span class="o">.</span><span class="n">fileContent</span><span class="o">.</span><span class="n">cell</span>
<span class="go">{'a': '64.8970031738', 'c': '38.7919998169', 'b': '78.3229980469', 'beta': '1.57079632679', 'alpha': '1.57079632679', 'gamma': '1.57079632679'}</span>
</pre></div>
</div>
<p>The file content classes are mostly being developed as required - please
contact Liz if you need further functionality.</p>
<p>The file classes also contain two integer flags, <em>contentFlag</em> and
<em>subType</em> that indicate something about the content of a selected file.
The <em>contentFlag</em> is most important for mini MTZs to indicate the
representation of the data (see <a class="reference external" href="../general/miniMtzs.html">miniMtzs</a>
for explanation).</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>CObsDataFile</strong></p></td>
</tr>
<tr class="row-odd"><td><p>CObsDa
CObsDataFile.CONTENT_FLAG_IPAIR</p></td>
<td><p>1</p></td>
<td><p>Freidal’s pairs of
intensities</p></td>
</tr>
<tr class="row-even"><td><p>CObsDataFile.CONTENT_FLAG_FPAIR</p></td>
<td><p>2</p></td>
<td><p>Freidal’s pairs of
structure factors</p></td>
</tr>
<tr class="row-odd"><td><p>CObsDataFile.CONTENT_FLAG_IMEAN</p></td>
<td><p>3</p></td>
<td><p>averaged intensities</p></td>
</tr>
<tr class="row-even"><td><p>CObsDataFile.CONTENT_FLAG_FMEAN</p></td>
<td><p>4</p></td>
<td><p>averaged structure
factors</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p><strong>CPhsDataFile</strong></p></td>
</tr>
<tr class="row-even"><td><p>CPhsDataFile.CONTENT_FLAG_HL</p></td>
<td><p>1</p></td>
<td><p>Hendrickson-Lattmann
coefficients</p></td>
</tr>
<tr class="row-odd"><td><p>CPhsDataFile.CONTENT_FLAG_PHIFOM</p></td>
<td><p>1</p></td>
<td><p>phase and figure of merit</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CMapCoeffsDataFile</strong></p></td>
</tr>
<tr class="row-odd"><td><p>CMapCoeffsDataFile.CONTENT_FLAG_FPHI</p></td>
<td><p>1</p></td>
<td><p>structure facture and
phase</p></td>
</tr>
</tbody>
</table>
<p>The <em>contentFlag</em> is presently only used for mini-MTZs but, in
principle, could be used to distiguish different forms of other data
files. This flag is useful in automating handling of the mini-MTZs and
ensuring programs are given data in a representation that they can
handle.</p>
<p>The <em>subType</em> flag is presently used by mini-MTZ classes and
<em>CPdbDataFile</em> to indicate the scientific content of the data.</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>CPdbDataFile</strong></p></td>
</tr>
<tr class="row-odd"><td><p>CPdbDataFile.SUBTYPE_UNKNOWN</p></td>
<td><p>0</p></td>
<td><p>unknown</p></td>
</tr>
<tr class="row-even"><td><p>CPdbDataFile.SUBTYPE_MODEL</p></td>
<td><p>1</p></td>
<td><p>working model</p></td>
</tr>
<tr class="row-odd"><td><p>C
PdbDataFile.SUBTYPE_HOMOLOG</p></td>
<td><p>2</p></td>
<td><p>homolog</p></td>
</tr>
<tr class="row-even"><td><p>CP
dbDataFile.SUBTYPE_FRAGMENT</p></td>
<td><p>3</p></td>
<td><p>structure fragment (e.g.
ligand)</p></td>
</tr>
<tr class="row-odd"><td><p>CPdbDataFile.SUBTYPE_HEAVY_ATOMS</p></td>
<td><p>4</p></td>
<td><p>heavy atoms</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CObsDataFile</strong></p></td>
</tr>
<tr class="row-odd"><td><p>CObsDataFile.SUBTYPE_OBSERVED</p></td>
<td><p>1</p></td>
<td><p>observed data</p></td>
</tr>
<tr class="row-even"><td><p>CObsDataFile.SUBTYPE_DERIVED</p></td>
<td><p>2</p></td>
<td><p>derived data</p></td>
</tr>
<tr class="row-odd"><td><p>CObsDataFile.SUBTYPE_REFERENCE</p></td>
<td><p>3</p></td>
<td><p>reference data</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CPhsDataFile</strong></p></td>
</tr>
<tr class="row-odd"><td><p>CPhsDataFile.SUBTYPE_UNBIASED</p></td>
<td><p>1</p></td>
<td><p>unbiased phases</p></td>
</tr>
<tr class="row-even"><td><p>CPhsDataFile.SUBTYPE_BIASED</p></td>
<td><p>2</p></td>
<td><p>biased phases</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p><strong>CMapCoeffsDataFile</strong></p></td>
</tr>
<tr class="row-even"><td><p>CMapCoeffsDataFile.SUBTYPE_NORMAL</p></td>
<td><p>1</p></td>
<td><p>normal map</p></td>
</tr>
<tr class="row-odd"><td><p>CMapCoeffsDataFile.SUBTYPE_DIFFERENCE</p></td>
<td><p>2</p></td>
<td><p>difference map</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CCootHistoryDataFile</strong></p></td>
</tr>
<tr class="row-odd"><td><p>CCootHistoryDataFile.SUBTYPE_INITIAL</p></td>
<td><p>1</p></td>
<td><p>Initialisation for Coot</p></td>
</tr>
<tr class="row-even"><td><p>CCootHistoryDataFile.SUBTYPE_HISTORY</p></td>
<td><p>2</p></td>
<td><p>Coot history file</p></td>
</tr>
</tbody>
</table>
<p>This information can be used to ensure that the data is used
appropriately. Obviously the <em>subType</em> can be tricky to define so its
use in the code is intended to be flexible.</p>
<p>If these flags are set in a <em>CDataFile</em> class that is being saved to the
database then the <em>contentFlag</em> and/or <em>subType</em> are saved to the
database. It is very helpful therefore if
<em>CPluginScript.processOutputFiles()</em> implementations set these flags for
output files. It is also possible to set a default value for
<em>contentFlag</em> or <em>subType</em> in a wrapper def file if the nature of the
program output file is known in advance (but done here is probably less
obvious and may not be maintained properly).</p>
<p>It is possible to select input files based on the <em>contentFlag</em> or
<em>subType</em> but note the handling of these two sorts of parameters is
different and potentially could be different again for different data
file classes. The input file selection is specified by the qualifiers:
<em>requiredContentFlag</em> and <em>requiredSubType</em> both of which are expected
to be a list of integers.</p>
<p>Currently the <em>requiredContentFlag</em> is only appropriate for mini-MTZ
classes and should be set if a program can only handle a limited set of
the possible mini-MTZ representations and the GUI will then only allow
selection of files containing the appropriate representation or
containing data that can be converted to the appropriate representation.</p>
<p>The definition of <em>subType</em> is less clear-cut than the <em>contentFlag</em>
especially for PDB files so when specifying a list of <em>requiredSubType</em>
consider giving <em>CPdbDataFile.SUBTYPE_UNKNOWN</em> (i.e. 0) as the last
value in the list as this serves as a ‘wildcard’ which will allow any
PDB file to be selected but the GUI will set the default and the first
choices on a drop-down list to be of the preferred <em>subType</em>.</p>
<p>In conclusion: in <em>CPluginScript.processOutputFiles()</em> set <em>contentFlag</em>
and <em>subType</em> for the output file data classes that support these and in
the def file set qualifers <em>requiredContentFlag</em> and <em>requiredSubType</em>
for input file data classes.</p>
<hr class="docutils"/>
<p>Last modified: Thu Apr 23 10:21:59 BST 2015</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="error_handling.html" title="CCP4I2 Developers Error Handling"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> CCP4I2 Developers Error Handling </span>
              </div>
            </a>
          
          
            <a href="modules/index.html" title="CCP4i2 Data Classes"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> CCP4i2 Data Classes </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2020, CCP4.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.2.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>