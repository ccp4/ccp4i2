
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#00020a">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>CCP4i2 — Running CCP4i2 Job on a Server &#8212; CCP4i2  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/contentui.css" />
    <link rel="stylesheet" type="text/css" href="https://github.com/bwithd/sphinx-material/blob/main/sphinx_material/sphinx_material/static/stylesheets/application.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/contentui.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=#005BBB data-md-color-accent=yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500" id="__gitlab"><path fill="currentColor" d="M93.667 473.347l90.684-279.097H2.983l90.684 279.097z" transform="translate(156.198 1.16)"/><path fill="currentColor" d="M221.333 473.345L130.649 194.25H3.557l217.776 279.095z" transform="translate(28.531 1.16)" opacity=".7"/><path fill="currentColor" d="M32 195.155L4.441 279.97a18.773 18.773 0 0 0 6.821 20.99l238.514 173.29L32 195.155z" transform="translate(.089 .256)" opacity=".5"/><path fill="currentColor" d="M2.667-84.844h127.092L75.14-252.942c-2.811-8.649-15.047-8.649-17.856 0L2.667-84.844z" transform="translate(29.422 280.256)"/><path fill="currentColor" d="M2.667 473.345L93.351 194.25h127.092L2.667 473.345z" transform="translate(247.198 1.16)" opacity=".7"/><path fill="currentColor" d="M221.334 195.155l27.559 84.815a18.772 18.772 0 0 1-6.821 20.99L3.557 474.25l217.777-279.095z" transform="translate(246.307 .256)" opacity=".5"/><path fill="currentColor" d="M130.667-84.844H3.575l54.618-168.098c2.811-8.649 15.047-8.649 17.856 0l54.618 168.098z" transform="translate(336.974 280.256)"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#general/servers" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="CCP4i2  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">CCP4i2  documentation</span>
          <span class="md-header-nav__topic"> CCP4i2 — Running CCP4i2 Job on a Server </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">CCP4i2  documentation</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="CCP4i2 documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="CCP4i2 documentation">CCP4i2  documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://gitlab.com/ccp4i2/rstdocs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    
  </div>
</a>
    </div>
  
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#general-servers--page-root" class="md-nav__link">CCP4i2 — Running CCP4i2 Job on a Server</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#overview-of-mechanism" class="md-nav__link">Overview of mechanism</a>
        </li>
        <li class="md-nav__item"><a href="#configuring-running-on-a-server" class="md-nav__link">Configuring running on a server</a>
        </li>
        <li class="md-nav__item"><a href="#running-jobs-on-a-server-from-scripts" class="md-nav__link">Running jobs on a server from scripts</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/general/servers.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="ccp4i2-running-ccp4i2-job-on-a-server">
<h1 id="general-servers--page-root">CCP4i2 — Running CCP4i2 Job on a Server<a class="headerlink" href="#general-servers--page-root" title="Permalink to this heading">¶</a></h1>
<table>
<thead>
<tr class="row-odd"><th class="head"><p><a class="reference external" href="CCP4i1Projects.html">CCP4i
projects</a></p></th>
<th class="head"><p><a class="reference external" href="data_files.html">E
xperimental
dat
a</a></p></th>
<th class="head"><p><a class="reference external" href="model_data.html">Model
dat
a</a></p></th>
<th class="head"><p><a class="reference external" href="atom_selection.html">Atom
s
election</a></p></th>
<th class="head"><p><a class="reference external" href="servers.html">Ser
vers</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<section id="introduction">
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p><img alt="Server gui" src="../_images/runremote.png"/></p>
<p>CCP4i2 usually runs jobs on the user’s computer but can also send jobs
to a server. The CCP4i2 installation must first be configured to know
about the available servers (this should usually be done by whoever
installs CCP4i2) and then a ‘Run on server’ option will appear in the
<em>Project Viewer</em> toolbar. When you click this option you will see a
window with, at the top, a selection from one or more groups of servers
and then a pull-down menu to choose the server machine. CCP4i2 needs to
know the installation directory for CCP4 on the server machine but this
is usually already provided and you then need to enter your user name
and password on the server. You will not need to enter any of these
details again in this CCP4i2 session. The password is not saved
anywhere.</p>
<p>CCP4i2 polls the remote running job at regular intervals to retrieve the
current status and data to display in the ‘running’ report and to check
if the job has finished. You can check if a server job is still running
using the <em>Running jobs and processes</em> option on the <em>Utilities</em> menu.
This will list the jobs running on your local machine and any server
that you are using. For each job it should list a ‘ccp4i2’ process that
is the controlling process and one or more child processes that are the
running programs.</p>
</section>
<section id="overview-of-mechanism">
<h2 id="overview-of-mechanism">Overview of mechanism<a class="headerlink" href="#overview-of-mechanism" title="Permalink to this heading">¶</a></h2>
<p>CCP4i2 uses different mechanisms to run jobs on servers dependent on
whether or not the client and server machines share a file system and
whether they support job queues. All current mechanisms assume that the
servers are running Linux.</p>
<p>Where server and client are part of a Linux cluster they are often set
up with a shared filesystem and there is no need to transfer files to
and from the server. If there is not a shared file system (certainly the
case if the client is a Mac or Windows PC) then files must be copied and
this is done by creating and copying a <em>‘jobball’</em> which is a zip file
containing a small fraction of the users project directory with the
directory structure of the project directory and just the necessary
files to run the job. When the job has finished on the server another
<em>jobball</em>, now containing the output files, is created and returned.</p>
<p>Running on a server uses a temporary database local to the server. This
is true even if there is a shared file system - it is necessary to avoid
potential issues with the database locking mechanism over NFS file
systems. So, when running a server job a small fragment of the database
is exported (as an XML file) and copied to the server where it is used
to initialise the temporary database. When the job finishes the
temporary database will contain information on the jobs run and files
created and this is exported as XML and returned to the client machine
to be reintegrated into the user’s database.</p>
<div class="line-block">
<div class="line">CCP4i2 uses the <em>paramiko</em> Python library (distributed with CCP4)
which provides <em>ssh</em> functionality on all platforms. CCP4i2 currently
supports these alternative mechanisms for running on a server:</div>
<div class="line"><strong>Using ssh without a shared file system.</strong> This mechanism should work
for any Linux server and any Linux, Mac or Windows client. It does not
require any additional software installation. It will copy a <em>jobball</em>
to and from the server using an implementation of <em>scp</em>.</div>
<div class="line"><strong>Using ssh with a shared file system</strong> Will work if the client
machine is part of the same Linux cluster as the server and the
machines see the same filesystem with the same pathnames. This does
not require copying potentially large files and is to be preferred if
possible.</div>
<div class="line"><strong>Using qsub queuing system</strong> This requires that <em>qsub</em> is installed
but has the benefit of providing scheduling of jobs which may be
advantageous for large jobs. CCP4i2 has been tested against . If you
try against an alternative version we will be grateful for your
feedback.</div>
</div>
<p>The Grid Engine system supports the idea of submit hosts (from which a
job can be submitted) and execution hosts (on which the job is run) and
this will be set up by your system manager. Ideally your working machine
should be a submit host so CCP4i2 can just submit a job on your working
machine and the Grid Engine deals with communication to an execution
host. If your working machine is not a submit host then CCP4i2 can be
configured to use <strong>qsub on another machine</strong> or <strong>qsub with shared file
system</strong> where CCP4i2 uses ssh tools to copy files and submit a qsub job
on another machine.</p>
</section>
<section id="configuring-running-on-a-server">
<h2 id="configuring-running-on-a-server">Configuring running on a server<a class="headerlink" href="#configuring-running-on-a-server" title="Permalink to this heading">¶</a></h2>
<p>The <em>Configure servers</em> option can be found as part of the <em>Utilities</em>
menu option for <em>System administrator tools</em>. The setup can be for an
individual user (saved in their home directory
<em>.CCP4I2/configs/serverSetup.params.xml</em>) or for all users of the CCP4i2
installation (saved in
<em>ccp4/shared/ccp4i2/local_setup/serverSetup.params.xml</em>).</p>
<p><img alt="image1" src="../_images/serverSetup.png"/></p>
<p>At the top of the <em>Configure servers</em> window it tells you the current
context and has the option to load the alternative file if it is
present.</p>
<p>You can configure one or more groups of servers. A group of servers have
similar properties. For each server group you should enter a name and
choose the mechanism (see <a class="reference external" href="#mechanisms">Overview of mechanisms</a>
above). You can then enter a list of available server machines (note:
use the +/- below the list to add/remove lines in the list, enter the
server address in the text entry box below the list). If you want to
allow users to add server addresses then check the next box. You need to
provide the directory path for the CCP4 installation on the server
machine - the user can enter or edit this a run time but it is
preferable that they do not need to. If the mechanism does not use a
shared file system then you must provide a directory path for temporary
files. If the path includes the user name (which will be entered by the
user at run time) this should be entered as ‘$USER’.</p>
<p>There is an option for each server group to <em>Test server group</em>. For
each machine in the server group it will make an ssh connection and test
the existance of the CCP4 installation directory and the temporary
directory. You will be required to provide an login name and password
for the server machines.</p>
<p>The <em>qsub</em> queuing mechanism has many options (see
<a class="reference external" href="http://gridscheduler.sourceforge.net/htmlman/htmlman1/qsub.html">documentation</a>).
Options can be placed in a file and if an option file exists then CCP4i2
will invoke it when using <em>qsub</em>. The option file can be either
<em>$CCP4/share/ccp4i2/local_setup/qsub_options</em> applied for all users of
the CCP4 installation or <em>$HOME/.CCP4I2/configs/qsub_options</em> for a
single user.</p>
<p>At the bottom of the window, the parameters can be saved for either user
or installation; if the user does not have write permission for the
installation this option will not be presented.</p>
<p>Computer setups and requirements are very variable - if the above
mechanisms are not ideal for you please contact CCP4 describing your
setup and preferred mechanism for using servers.</p>
</section>
<section id="running-jobs-on-a-server-from-scripts">
<h2 id="running-jobs-on-a-server-from-scripts">Running jobs on a server from scripts<a class="headerlink" href="#running-jobs-on-a-server-from-scripts" title="Permalink to this heading">¶</a></h2>
<p>The <em>Job controller</em> in CCP4i2 controls the running of jobs either on
the local machine or a server machine. Within the CCP4i2 gui the <em>Job
controller</em> works by polling the database for jobs that have been tagged
as waiting to run. To run a job on a server (rather than locally) the
server parameters described above must previously have been set for the
<em>jobId</em> in the <em>Job controller</em>.</p>
<p>The server parameters are held by the <em>CCP4JobController.CServerParams</em>
class which presently is just:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CServerParams</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">machine</span> <span class="o">=</span>  <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'machine'</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span>  <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'username'</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span>  <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'password'</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ccp4Dir</span> <span class="o">=</span>  <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'ccp4Dir'</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tempDir</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'tempDir'</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mechanism</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'mechanism'</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>These parameters can be set in the <em>Job controller</em> and the job started
by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qtcore</span> <span class="kn">import</span> <span class="n">CCP4JobController</span>
<span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">CCP4Modules</span>
<span class="n">params</span> <span class="o">=</span><span class="n">CCP4JobController</span><span class="o">.</span><span class="n">CServerParams</span><span class="p">(</span><span class="n">machine</span><span class="o">=</span><span class="s1">'xxx.xxx.xxx'</span><span class="p">,</span><span class="n">ccp4Dir</span><span class="o">=</span><span class="s1">'/y/xtal/ccp4'</span><span class="p">,</span>
   <span class="n">mechanism</span><span class="o">=</span><span class="s1">'ssh_shared'</span><span class="p">,</span><span class="n">username</span><span class="o">=</span><span class="s1">'me'</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s1">'secret'</span><span class="p">)</span>
<span class="n">CCP4Modules</span><span class="o">.</span><span class="n">JOBCONTROLLER</span><span class="p">()</span><span class="o">.</span><span class="n">setServerParams</span><span class="p">(</span><span class="n">jobId</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
<span class="n">CCP4Modules</span><span class="o">.</span><span class="n">JOBCONTROLLER</span><span class="p">()</span><span class="o">.</span><span class="n">runOnServer</span><span class="p">(</span><span class="n">jobId</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>jobId</em> is a Python string representation of the databases uuid
(universal unique identifier).</p>
<p>Last modified: Tue Aug 30 12:14:39 BST 2016</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2020, CCP4.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.2.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>