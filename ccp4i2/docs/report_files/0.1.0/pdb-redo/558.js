"use strict";(self.webpackChunkpdb_redo_session_manager=self.webpackChunkpdb_redo_session_manager||[]).push([[558],{23558:(t,e,r)=>{r.r(e);var n=r(91164);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,l=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){l=!0,a=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}(t,e)||function(t,e){var r;if(t)return"string"==typeof t?i(t,e):"Map"===(r="Object"===(r=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,function(t){return t=function(t,e){if("object"!==a(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return String(t);if("object"!==a(r=r.call(t,"string")))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),"symbol"===a(t)?t:String(t)}(n.key),n)}}var c=function(){function t(e,r,a,i,s){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");r.sort((function(t,e){return t-e})),this.x=e,this.values=r,this.score=a,this.colour=i,this.sigma=s,i=(e=o(r.map((function(t){return[t,t]})).reduce((function(t,e){return[Math.min(t[0],e[0]),Math.max(t[1],e[1])]})),2))[0],s=e[1],this.min=i,this.max=s,this.quartiles=[n.VRg(r,.25),n.VRg(r,.5),n.VRg(r,.75)],e=this.quartiles[2]-this.quartiles[0],this.whiskers=[Math.max(i,this.quartiles[0]-1.5*e),Math.min(s,this.quartiles[2]+1.5*e)],this.range=[Math.min(a,Math.max(i,this.quartiles[0]-3*e)),Math.max(a,Math.min(s,this.quartiles[2]+3*e))]}var e,r;return e=t,(r=[{key:"outliers",value:function(t){var e=this;return this.values.filter((function(r){return r>t[0]&&r<e.whiskers[0]||r<t[1]&&r>e.whiskers[1]}))}},{key:"length",value:function(){return this.values.length}}])&&s(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function l(t,e,r,a,o,i){var s=40,c=n.tiA().domain(o.map((function(t){return t.x}))).rangeRound([40,t-20]).padding(.25,.25),l=n.BYU().domain(i).nice().range([e-50,s]),u=n.Ys("body").append("svg").attr("width",t).attr("height",e).attr("class","box"),d=(r=((s=(u.append("text").attr("x",t/2).attr("y",s/2).attr("text-anchor","middle").attr("font-size","large").text(r),u.append("g").selectAll("g").data(o).enter().append("g"))).append("line").attr("stroke","black").style("stroke-dasharray","4,2").attr("x1",(function(t){return c(t.x)+c.bandwidth()/2})).attr("x2",(function(t){return c(t.x)+c.bandwidth()/2})).attr("y1",(function(t){return l(t.whiskers[0])})).attr("y2",(function(t){return l(t.whiskers[1])})),s.append("line").attr("stroke","black").attr("x1",(function(t){return c(t.x)+c.bandwidth()/4})).attr("x2",(function(t){return c(t.x)+3*c.bandwidth()/4})).attr("y1",(function(t){return l(t.whiskers[0])})).attr("y2",(function(t){return l(t.whiskers[0])})),s.append("line").attr("stroke","black").attr("x1",(function(t){return c(t.x)+c.bandwidth()/4})).attr("x2",(function(t){return c(t.x)+3*c.bandwidth()/4})).attr("y1",(function(t){return l(t.whiskers[1])})).attr("y2",(function(t){return l(t.whiskers[1])})),s.append("rect").attr("fill","#fff").attr("stroke","black").attr("x",(function(t){return c(t.x)})).attr("y",(function(t){return l(t.quartiles[2])})).attr("width",c.bandwidth()).attr("height",(function(t){return l(t.quartiles[0])-l(t.quartiles[2])})),s.append("line").attr("stroke","black").attr("stroke-width",2).attr("x1",(function(t){return c(t.x)})).attr("x2",(function(t){return c(t.x)+c.bandwidth()})).attr("y1",(function(t){return l(t.quartiles[1])})).attr("y2",(function(t){return l(t.quartiles[1])})),s.append("g").attr("fill","black").attr("fill-opacity",.2).attr("stroke","none").attr("transform",(function(t){return"translate(".concat(c(t.x)+c.bandwidth()/2,",0)")})).selectAll("circle").data((function(t){return t.outliers(i)})).enter().append("circle").attr("r",1.5).attr("cx",(function(){return 4*(Math.random()-.5)})).attr("cy",(function(t){return l(t)})),u.selectAll("rect.score").data(o).enter().append("rect").attr("class","score").attr("fill",(function(t){return t.colour})).attr("opacity",.2).attr("x",40).attr("width",t-40-20).attr("y",(function(t){return l(t.score+t.sigma)})).attr("height",(function(t){return Math.abs(l(t.score+t.sigma)-l(t.score-t.sigma))})),u.selectAll("line.score").data(o).enter().append("line").attr("class","score").attr("stroke",(function(t){return t.colour})).attr("x1",40).attr("x2",t-20).attr("y1",(function(t){return l(t.score)})).attr("y2",(function(t){return l(t.score)})),u.append("g").call((function(t){return t.attr("transform","translate(0,".concat(e-50,")")).call(n.LLu(c).ticks(2).tickSizeOuter(0))})),u.append("g").call((function(t){return t.attr("transform","translate(".concat(40,",0)")).call(n.y4O(l).ticks(null,"s")).call((function(t){return t.select(".domain").remove()}))})),u.append("text").attr("transform","rotate(-90)").attr("y",6).attr("x",-e/2).attr("text-anchor","middle").attr("dy","0.7em").attr("font-size","small").text(a),u.append("text").attr("text-anchor","end").attr("x",t-6).attr("y",e).attr("dy","-0.7em").attr("font-size","xx-small").text("N=".concat(o[0].length())),u.append("g").attr("transform","translate(10,".concat(e-50+22,")")).selectAll("g.legend").data(o).enter().append("g").attr("class","legend")),n.tiA().domain(o.map((function(t){return t.x}))).rangeRound([0,26]).padding(.2,.1));return r.append("line").attr("stroke",(function(t){return t.colour})).attr("x1",0).attr("x2",20).attr("y1",(function(t){return d(t.x)+d.bandwidth()/2})).attr("y2",(function(t){return d(t.x)+d.bandwidth()/2})),r.append("text").attr("x",25).attr("y",(function(t){return d(t.x)+d.bandwidth()/2})).attr("dy","0.3em").attr("font-size","xx-small").text((function(t){return t.x})),u.node()}var u,d,h,p,f=r(79897);function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function y(t,e){return e=e||t.slice(0),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function b(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,function(t){return t=function(t,e){if("object"!==g(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return String(t);if("object"!==g(r=r.call(t,"string")))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),"symbol"===g(t)?t:String(t)}(n.key),n)}}function v(t,e){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var k=Object.freeze({contour:{name:"Contour",nr:2,img:"line",alhpa:1},heatmap:{name:"Heatmap",nr:1,img:"heatmap",alhpa:.6}}),x=Object.freeze({general:{name:"General case",nr:1,img:"GeneralContour"},ileval:{name:"Isoleucine and valine",nr:2,img:"IleVal"},prepro:{name:"Pre-proline",nr:3,img:"PrePro"},gly:{name:"Glycine",nr:4,img:"Gly"},transpro:{name:"Trans proline",nr:5,img:"TransPro"},cispro:{name:"Cis proline",nr:6,img:"CisPro"}});e=function(t){var e=o;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t);var r,a=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=w(t);if(r=e?(r=w(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments),n=this,r&&("object"===g(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==n)return n;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}(o);function o(){var t;if(this instanceof o)return(t=a.call(this)).width=400,t.noshadow=!1,t.noheader=!1,t.error=null,t.pdbRedoBaseURI=document.querySelector('script[src$="pdb-redo-result-loader.js"]').src.replace(/scripts\/pdb-redo-result-loader\.js$/,""),t.hoveredItem="",t.hoveredData=null,t.margin={top:30,right:30,bottom:30,left:30},t.backgroundType=k.contour,t.images={},t.loadImages(k.contour),t.show={preferred:!1,allowed:!0,outlier:!0},t;throw new TypeError("Cannot call a class as a function")}return e=o,t=[{key:"properties",get:function(){return{width:{type:Number},error:{type:String},noshadow:{type:Boolean,attribute:"no-shadow"},noheader:{type:Boolean,attribute:"no-header"}}}},{key:"styles",get:function(){return(0,f.iv)(p=p||y(['\n\t\t\t* {\n\t\t\t\tfont-family: "Verdana", "Arial", "Helvetica", "sans-serif";\n\t\t\t}\n\n\t\t\theader, footer {\n\t\t\t\tcolor: white;\n\t\t\t\tbackground-color: #3366cc;\n\t\t\t}\n\n\t\t\theader img {\n\t\t\t\tbackground-color: white;\n\t\t\t\theight: 1.2em;\n\t\t\t\twidth: auto;\n\t\t\t}\n\n\t\t\tg.tick line {\n\t\t\t\tstroke: lightgrey;\n\t\t\t\topacity: 0.7;\n\t\t\t\tshape-rendering: crispEdges;\n\t\t\t}\n\n\t\t\tg.res circle {\n\t\t\t\tfill: #2c58b0;\n\t\t\t\topacity: 0.6;\n\t\t\t}\n\n\t\t\tcircle.orig-label {\n\t\t\t\tfill: #2c58b0;\n\t\t\t\topacity: 0.6;\n\t\t\t}\n\n\t\t\tg.res {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\n\t\t\tsvg.show-preferred g.res.preferred {\n\t\t\t\tdisplay: unset;\n\t\t\t}\n\n\t\t\tsvg.show-allowed g.res.allowed {\n\t\t\t\tdisplay: unset;\n\t\t\t}\n\n\t\t\tsvg.show-outlier g.res.outlier {\n\t\t\t\tdisplay: unset;\n\t\t\t}\n\n\t\t\tg.res circle.redo, circle.redo-label {\n\t\t\t\tfill: #FF9933;\n\t\t\t\topacity: 0.6;\n\t\t\t}\n\n\t\t\tg.res line {\n\t\t\t\tstroke: gray;\n\t\t\t\tstroke-width: 1;\n\t\t\t\topacity: 0.6;\n\t\t\t}\n\n\t\t\tg.res.hover circle, g.res.hover line {\n\t\t\t\topacity: 1;\n\t\t\t}\n\n\t\t\tg.res.hover circle {\n\t\t\t\tstroke: red;\n\t\t\t\tstroke-width: 0.75;\n\t\t\t}\n\n\t\t\tg.res.hover line {\n\t\t\t\tstroke: red;\n\t\t\t}\n\n\t\t\tsvg, canvas {\n\t\t\t\tposition: absolute;\n\t\t\t}\n\n\t\t\tcanvas {\n\t\t\t\tz-index: -1;\n\t\t\t}\n\n\t\t\tfooter {\n\t\t\t\tmargin-top: 1rem;\n\t\t\t}\n\n\t\t\tfooter p {\n\t\t\t\tfont-size: small;\n\t\t\t}\n\t\t']))}}],(r=[{key:"render",value:function(){var t=this;return(0,f.dy)(u=u||y(['\n\t\t\t<link rel="stylesheet" href="',"\" crossorigin='anonymous'>\n\t\t\t\x3c!-- template content --\x3e\n\t\t\t<div class=\"",'" style="width: ','px">\n\t\t\t\t','\n\n\t\t\t\t<div class="w3-container">\n\t\t\t\t\t','\n\n\t\t\t\t\t<div style="width: ',"px; height: ",'px"\n\t\t\t\t\t\t@click="','">\n\t\t\t\t\t\t<svg width="','" height="',"\"\n\t\t\t\t\t\t\tpreserveAspectRatio='xMinYMin meet'\n\t\t\t\t\t\t\tviewBox='0 0 "," ","'\n\t\t\t\t\t\t\tclass=\"","\n\t\t\t\t\t\t\t\t   ","\n\t\t\t\t\t\t\t\t   ",'">\n\t\t\t\t\t\t</svg>\n\n\t\t\t\t\t\t<canvas width="','" height="','"></canvas>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<table class="w3-table-all '," w3-small w3-margin-bottom\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th colspan=\"2\">Description</th>\n\t\t\t\t\t\t\t<th>PDB\n\t\t\t\t\t\t\t\t<svg width='20' height='16' viewBox='0 0 20 16'>\n\t\t\t\t\t\t\t\t\t<circle class=\"orig-label\" cx='12' cy='8' r='6'/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th>PDB-REDO\n\t\t\t\t\t\t\t\t<svg width='20' height='16' viewBox='0 0 20 16'>\n\t\t\t\t\t\t\t\t\t<circle class=\"redo-label\" cx='12' cy='8' r='6'/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td colspan=\"2\">","</td>\n\t\t\t\t\t\t\t<td>","</td>\n\t\t\t\t\t\t\t<td>",'</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td colspan="2">\n\t\t\t\t\t\t\t\tRamachandran Z-score\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>',"</td>\n\t\t\t\t\t\t\t<td>","</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<img crossorigin='anonymous' src=\"",'"\n\t\t\t\t\t\t\t\t\t data-target="preferred" @click="','"/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>Preferred regions</td>\n\t\t\t\t\t\t\t<td>',"</td>\n\t\t\t\t\t\t\t<td>","</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<img crossorigin='anonymous' src=\"",'"\n\t\t\t\t\t\t\t\t\tdata-target="allowed" @click="','"/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>Allowed regions</td>\n\t\t\t\t\t\t\t\t<td>',"</td>\n\t\t\t\t\t\t\t<td>","</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<img crossorigin='anonymous' src=\"",'"\n\t\t\t\t\t\t\t\t\tdata-target="outlier" @click="','"/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>Outliers</td>\n\t\t\t\t\t\t\t\t<td>',"</td>\n\t\t\t\t\t\t\t<td>","</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t"]),new URL("css/w3.css",this.pdbRedoBaseURI),this.noshadow?"":"w3-card",this.width+32,this.noheader?"":(0,f.dy)(d=d||y(['\n\t\t\t\t\t<header class="w3-container">\n\t\t\t\t\t\t<h3><a href="https://pdb-redo.eu">\n\t\t\t\t\t\t\t<img crossorigin=\'anonymous\' src="','" alt="PDB-REDO"/></a>\n\t\t\t\t\t\t\tKleywegt-like plot for ',"\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t</header>"]),new URL("images/PDB_logo_rect_small.svg",this.pdbRedoBaseURI),this.pdbID),null!==this.error&&"null"!=this.error?(0,f.dy)(h=h||y(['\n\t\t\t\t\t\t\t<div class="w3-panel w3-pale-red w3-border">\n\t\t\t\t\t\t\t\t<h3>Error</h3>\n\t\t\t\t\t\t\t\t<p>',"</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"]),this.error):"",this.width,this.width,(function(){return t.toggleBackground()}),this.width,this.width,this.width,this.width,this.show.preferred?"show-preferred":"",this.show.allowed?"show-allowed":"",this.show.outlier?"show-outlier":"",this.width,this.width,this.noshadow?"":"w3-card",this.hoveredItem?this.hoveredItem.name:" ",this.hoveredItem?this.hoveredItem.orig:" ",this.hoveredItem?this.hoveredItem.redo:" ",this.stats?this.stats.orig.zscore:" ",this.stats?this.stats.redo.zscore:" ",new URL(this.show.preferred?"images/checkbox-checked.svg":"images/checkbox-unchecked.svg",this.pdbRedoBaseURI),this.toggleChecbox,this.stats?this.stats.orig.preferred:" ",this.stats?this.stats.redo.preferred:" ",new URL(this.show.allowed?"images/checkbox-checked.svg":"images/checkbox-unchecked.svg",this.pdbRedoBaseURI),this.toggleChecbox,this.stats?this.stats.orig.allowed:" ",this.stats?this.stats.redo.allowed:" ",new URL(this.show.outlier?"images/checkbox-checked.svg":"images/checkbox-unchecked.svg",this.pdbRedoBaseURI),this.toggleChecbox,this.stats?this.stats.orig.outliers:" ",this.stats?this.stats.redo.outliers:" ")}},{key:"updated",value:function(t){var e=n.Ys(this.shadowRoot.querySelector("svg")).select("g").empty(),r=null==this.data&&""==this.getAttribute("error");t.forEach((function(t,r){"width"===r&&(e=!0)})),e&&(this.rebuildSVG(),0==r)&&this.updateGraph()}},{key:"rebuildSVG",value:function(){var t=n.Ys(this.shadowRoot.querySelector("svg")),e=this.margin,r=this.width-e.left-e.right,a=r,o=(t=(t.selectAll(".graph-g").remove(),t.append("g").classed("graph-g",!0).attr("transform","translate(".concat(e.left,",").concat(e.top,")"))),n.BYU().domain([-180,180]).range([0,r])),i=n.LLu(o).tickSize(-a);t.append("g").classed("x",!0).attr("transform","translate(0, ".concat(a,")")).call(i),i=n.F5q(o).tickSize(0),t.append("g").classed("x",!0).call(i),o=n.BYU().domain([180,-180]).range([0,a]),i=n.Khx(o).tickSize(-r),t.append("g").classed("y",!0).attr("transform","translate(".concat(r,", 0)")).call(i),i=n.y4O(o).tickSize(0);t.append("g").classed("y",!0).call(i),t.append("text").attr("class","x axis-label").attr("text-anchor","middle").attr("x",r/2).attr("y",a+e.bottom-6).text("φ"),t.append("text").attr("class","y axis-label").attr("text-anchor","middle").attr("x",6-this.margin.left).attr("y",a/2).text("ψ"),this.updateBackground()}},{key:"setData",value:function(t,e){var r=this,a=(this.stats={orig:{zscore:t.OZRAMA,preferred:0,allowed:0,outliers:0},redo:{zscore:t.FZRAMA,preferred:0,allowed:0,outliers:0}},new Map),o=(e.forEach((function(t){t.chains.forEach((function(t){t.models[0].residues.forEach((function(e){var n="".concat(t.asym_id,"-").concat(e.seq_id);a.set(n,{chain:t.asym_id,residue_name:e.compound_id,residue_number:e.seq_id,key:n,orig:{phi:e.orig.phi,psi:e.orig.psi,rama:e.orig.rama,cis_peptide:e.orig.cis},redo:{phi:e.redo.phi,psi:e.redo.psi,rama:e.redo.rama,cis_peptide:e.redo.cis}});for(var o=0,i=["orig","redo"];o<i.length;o++){var s=i[o];switch(e[s].rama){case"Favored":r.stats[s].preferred+=1;break;case"Allowed":r.stats[s].allowed+=1;break;case"OUTLIER":r.stats[s].outliers+=1}}}))}))})),this.data=function(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var r;if(t)return"string"==typeof t?m(t,e):"Map"===(r="Object"===(r=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(a.values()),this.width-this.margin.left-this.margin.right),i=o,s=n.BYU().domain([-180,180]).range([0,o]),c=n.BYU().domain([180,-180]).range([0,i]);this.data.forEach((function(t){var e=s(t.orig.phi),r=c(t.orig.psi),n=s(t.redo.phi),a=c(t.redo.psi),l=(t.dist=Math.sqrt((e-n)*(e-n)+(r-a)*(r-a)),[(e+n)/2,(e+n)/2]),u=[(r+a)/2,(r+a)/2];180<Math.abs(t.orig.phi-t.redo.phi)?t.orig.phi<t.redo.phi?u[l[0]=0]=u[1]=r+e/((l[1]=o)-n+e)*(a-r):(l[0]=o,u[l[1]=0]=u[1]=a+n/(o-e+n)*(r-a)):180<Math.abs(t.orig.psi-t.redo.psi)&&(t.orig.psi>t.redo.psi?(u[0]=0,u[1]=i,l[0]=l[1]=e+r/(o-a+r)*(n-e)):(u[0]=i,l[u[1]=0]=l[1]=n+a/(o-r+a)*(e-n))),t.lines={orig:{x1:e,x2:l[0],y1:r,y2:u[0]},redo:{x1:n,x2:l[1],y1:a,y2:u[1]}}}));for(var l=1;l+1<this.data.length;++l)switch(this.data[l].residue_name){case"GLY":this.data[l].subclass="gly";break;case"ILE":case"VAL":this.data[l].subclass="ileval";break;case"PRO":this.data[l-1].redo.cis_peptide?this.data[l].subclass="cispro":this.data[l].subclass="transpro";break;default:"PRO"==this.data[l+1].residue_name?this.data[l].subclass="prepro":this.data[l].subclass="general"}this.requestUpdate()}},{key:"updateGraph",value:function(){var t=this,e=this.margin,r=e=this.width-e.left-e.right,a=n.Ys(this.shadowRoot.querySelector("svg")).select(".graph-g"),o=n.BYU().domain([-180,180]).range([0,e]),i=n.BYU().domain([180,-180]).range([0,r]),s=a.selectAll("g.res").data(this.data.filter((function(t){return void 0!==t.orig&&void 0!==t.redo&&null!==t.orig.phi})),(function(t){return t.key})),c=(s.exit().remove(),s.enter().append("g").classed("res",!0).classed("preferred",(function(t){return"Favored"===t.orig.rama||"Favored"===t.redo.rama})).classed("allowed",(function(t){return"Allowed"===t.orig.rama||"Allowed"===t.redo.rama})).classed("outlier",(function(t){return"OUTLIER"===t.orig.rama||"OUTLIER"===t.redo.rama})));["orig","redo"].forEach((function(e){c.append("circle").classed("dot",!0).classed(e,!0).attr("r",3).on("mouseover",(function(e,r){return t.onMouseOver(e.target,r)})).on("mouseout",(function(e,r){return t.onMouseOut(e.target,r)})),c.merge(s).select("circle.".concat(e)).attr("cx",(function(t){return o(t[e].phi)})).attr("cy",(function(t){return i(t[e].psi)})),c.append("line").classed("change",!0).classed("".concat(e,"-part"),!0).on("mouseover",(function(e,r){return t.onMouseOver(e.target,r)})).on("mouseout",(function(e,r){return t.onMouseOut(e.target,r)})),c.merge(s).select("line.change.".concat(e,"-part")).attr("x1",(function(t){return t.lines[e].x1})).attr("x2",(function(t){return t.lines[e].x2})).attr("y1",(function(t){return t.lines[e].y1})).attr("y2",(function(t){return t.lines[e].y2}))})),this.updateBackground()}},{key:"loadImages",value:function(t){var e=this,r=this.margin,n=this.width-r.left-r.right,a=n;Object.keys(x).forEach((function(r){var o=new Image(n,a);e.images[r]={img:o,img_loaded:!1},o.onload=function(){return e.images[r].img_loaded=!0},o.crossOrigin="anonymous",o.src=new URL("images/".concat(t.img+x[r].img,".png"),e.pdbRedoBaseURI)}))}},{key:"toggleBackground",value:function(){this.background===k.heatmap?this.background=k.contour:this.background=k.heatmap,this.loadImages(this.background),this.updateBackground()}},{key:"updateBackground",value:function(){var t,e,r,n,a,o=this,i=this.hoveredData?this.hoveredData.subclass:"general",s=this.images[i];this.selectBackground!=s&&(this.selectBackground=s,t=this.margin,e=this.width-t.left-t.right,r=e,n=k.contour.alhpa,(a=this.shadowRoot.querySelector("canvas").getContext("2d")).globalAlpha=n,a.clearRect(t.left+1,t.top+1,e-2,r-2),s.img_loaded?a.drawImage(s.img,t.left+1,t.top+1,e-2,r-2):s.img.onload=function(){o.images[i].img_loaded=!0,a.drawImage(s.img,t.left+1,t.top+1,e-2,r-2)})}},{key:"toggleChecbox",value:function(t){var e=(t=t.target).dataset.target,r=this.shadowRoot.querySelector("svg");this.show[e]?(this.show[e]=!1,r.classList.remove("show-".concat(e)),t.src=new URL("images/checkbox-unchecked.svg",this.pdbRedoBaseURI)):(this.show[e]=!0,r.classList.add("show-".concat(e)),t.src=new URL("images/checkbox-checked.svg",this.pdbRedoBaseURI))}},{key:"onMouseOver",value:function(t,e){t.parentNode.classList.add("hover"),this.hoveredItem={name:"".concat(e.chain,":").concat(e.residue_number," ").concat(e.residue_name," / ").concat(x[e.subclass].name),orig:"".concat(e.orig.phi.toFixed(1),"/").concat(e.orig.psi.toFixed(1)),redo:"".concat(e.redo.phi.toFixed(1),"/").concat(e.redo.psi.toFixed(1))},this.requestUpdate(),this.hoveredData=e,this.updateBackground()}},{key:"onMouseOut",value:function(t,e){t.parentNode.classList.remove("hover"),this.hoveredItem=null,this.requestUpdate(),this.hoveredData=null,this.updateBackground()}}])&&b(e.prototype,r),t&&b(e,t),Object.defineProperty(e,"prototype",{writable:!1}),o}(f.oi);function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,function(t){return t=function(t,e){if("object"!==R(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return String(t);if("object"!==R(r=r.call(t,"string")))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),"symbol"===R(t)?t:String(t)}(n.key),n)}}function S(t,e,r){return(S=A()?Reflect.construct.bind():function(t,e,r){var n=[null];return n.push.apply(n,e),e=new(Function.bind.apply(t,n)),r&&E(e,r.prototype),e}).apply(null,arguments)}function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function E(t,e){return(E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}r=function(t){var e=n;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t);var r=function(t){var e=A();return function(){var r,n=_(t);if(r=e?(r=_(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments),n=this,r&&("object"===R(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==n)return n;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}(n);function n(){var t;if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");(t=r.call(this)).pdbRedoBaseURI=document.querySelector('script[src$="pdb-redo-result-loader.js"]').src.replace(/\/?scripts\/pdb-redo-result-loader\.js$/,""),t.data=null,t.error=null,t.pdb_redo_url="https://pdb-redo.eu",t.data_url=null,t.include_credentials=!1;var e=t.attachShadow({mode:"open"}),a=((a=document.createElement("link")).setAttribute("href","/report_files/0.1.0/pdb-redo/css/web-component-style.css"),a.setAttribute("rel","stylesheet"),a.setAttribute("crossorigin","anonymous"),e.appendChild(a),document.createElement("div"));return e.appendChild(a),t}return e=n,(t=[{key:"connectedCallback",value:function(){var t;null!=(t=(null!=(t=this.getAttribute("data-url"))&&(this.data_url=t.replace(/\/+$/,"")),this.getAttribute("pdb-redo-url")))&&(this.pdb_redo_url=t.replace(/\/+$/,"")),this.include_credentials=null!=this.getAttribute("include-credentials"),this.pdbID=this.getAttribute("pdb-id"),this.tokenID=this.getAttribute("token-id"),this.tokenSecret=this.getAttribute("token-secret"),this.jobID=this.getAttribute("job-id"),this.reload()}},{key:"displayError",value:function(t){t="".concat(t);var e,r=this.shadowRoot,n=r.querySelector("div");(e=((e=((n=(r.removeChild(n),document.createElement("div"))).classList.add("alert","alert-warning"),n.setAttribute("role","alert"),document.createElement("h3"))).innerText="Something went wrong rendering the requested data",n.appendChild(e),document.createElement("div"))).innerText="The error message was: ".concat(t),n.appendChild(e),r.appendChild(n),r.querySelector("style")}},{key:"attributeChangedCallback",value:function(t,e,r){var n=!1;switch(t){case"data-url":case"pdb-redo-url":this.data_url!==r&&(this.data_url=r,n=!0);break;case"pdb-id":this.pdbID!==r&&(this.pdbID=r,n=!0)}n&&this.reload()}},{key:"reload",value:function(){null!=this.pdbID?this.reloadDBData():null!=this.data_url&&this.reloadRemoteData()}},{key:"reloadDBData",value:function(){var t=this;fetch("".concat(this.pdb_redo_url,"/db/entry?pdb-id=").concat(this.pdbID),{method:"post"}).then((function(t){if(t.ok)return t.text();throw"Error fetching data, status code was ".concat(t.status)})).then((function(e){return t.putEntry(e)})).catch((function(e){t.displayError(e)}))}},{key:"reloadRemoteData",value:function(){var t=this,e={};this.include_credentials&&(e.credentials="include"),fetch("".concat(this.data_url,"/data.json"),e).then((function(t){if(t.ok)return t.json();throw"Error fetching data, status code was ".concat(t.status)})).then((function(e){var r=new FormData;r.append("data.json",JSON.stringify(e)),r.append("link-url",t.data_url),fetch("".concat(t.pdb_redo_url,"/entry"),{method:"POST",body:r}).then((function(t){if(t.ok)return t.text();throw"Error fetching data, status code was ".concat(t.status)})).then((function(e){return t.putEntry(e)}))})).catch((function(e){t.displayError(e)}))}},{key:"putEntry",value:function(t){var e=this.shadowRoot,r=(t=(e.querySelector("div").innerHTML=t,Array.from(e.querySelectorAll("button.toggle")).forEach((function(t){return t.addEventListener("click",(function(t){var r="raw"===t.target.dataset.state;Array.from(e.querySelectorAll("table.perc-raw-toggle")).forEach((function(t){t.classList.toggle("perc",0==r),t.classList.toggle("raw",1==r)}))}))})),e.querySelector("#entry-data").innerHTML),t=JSON.parse(t),e.querySelector("#boxPlotTD")),n=(null!=r&&null!=t&&(null==(n=t.data).RFREE||!0===n.ZCALERR||n.TSTCNT!==n.NTSTCNT?n.RFREE=n.RFCALUNB:this.RFREE=n.RFCAL,function(t,e,r){var n=t.URESO;fetch("".concat(r,"/gfx/statistics-for-box-plot?ureso=").concat(n)).then((function(t){return t.json()})).then((function(r){return n=t,a=e,i=(o=[new c("PDB",r.map((function(t){return 100*t.RFREE})),100*n.RFREE,"blue",100*n.SIGRFCAL),new c("PDB-REDO",r.map((function(t){return 100*t.RFFIN})),100*n.RFFIN,"orange",100*n.SIGRFFIN)]).map((function(t){return t.range})).reduce((function(t,e){return[Math.min(t[0],e[0]),Math.max(t[1],e[1])]})),a.appendChild(l(225,500,"R-Free","%",o,i)),void(null!=n.OZRAMA&&null!=n.FZRAMA&&null!=n.FCHI12&&null!=n.OSCHI12&&(o=[new c("PDB",r.map((function(t){return t.OZRAMA})),n.OZRAMA,"blue",n.OSZRAMA),new c("PDB-REDO",r.map((function(t){return t.FZRAMA})),n.FZRAMA,"orange",n.FSZRAMA)],i=[new c("PDB",r.map((function(t){return t.OCHI12})),n.OCHI12,"blue",n.OSCHI12),new c("PDB-REDO",r.map((function(t){return t.FCHI12})),n.FCHI12,"orange",n.FSCHI12)],r=[].concat(o,i).map((function(t){return t.range})).reduce((function(t,e){return[Math.min(t[0],e[0]),Math.max(t[1],e[1])]})),a.appendChild(l(225,500,"Ramachandran Plot","Z-score",o,r)),a.appendChild(l(225,500,"Rotamer quality","Z-score",i,r))));var n,a,o,i})).catch((function(t){return console.log(t)}))}(n,r,this.pdb_redo_url)),e.querySelector("ramachandran-plot"));"object"===R(t["rama-angles"])&&null!=t["rama-angles"]?n.setData(t.data,t["rama-angles"]):e.querySelector("#rama-plot-div").classList.add("hide")}}])&&O(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),n}(function(t){var e="function"==typeof Map?new Map:void 0;return function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return S(t,arguments,_(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),E(r,t)}(t)}(HTMLElement)),customElements.define("pdb-redo-result",r),customElements.define("ramachandran-plot",e)}}]);
